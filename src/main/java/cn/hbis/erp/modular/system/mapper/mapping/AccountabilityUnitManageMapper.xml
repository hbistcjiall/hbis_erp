<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hbis.erp.modular.system.mapper.AccountabilityUnitManageMapper">


    <resultMap id="BaseResultMap" type="cn.hbis.erp.modular.system.entity.AccountabilityUnitManage">
        <id column="ACCOUNTABILITY_UNIT_ID" property="accountabilityunitid"/>
        <result column="ACCOUNTABILITY_UNIT_CODE" property="accountabilityunitcode"/>
        <result column="ACCOUNTABILITY_UNIT_NAME" property="accountname"/>

    </resultMap>

    <sql id="Base_Column_List">
        ACCOUNTABILITY_UNIT_ID AS ID,ACCOUNTABILITY_UNIT_CODE AS CODE,ACCOUNTABILITY_UNIT_NAME AS "NAME"
    </sql>
    <select id="selectaccunitname" parameterType="String" resultType="map">
        select
        <include refid="Base_Column_List"/>
        from SCM_ACCOUNTABILITY_UNIT_MANAGE
        where DELETESTATUS = '0'
        <if test="accountname != null and accountname !=''">

            and ACCOUNTABILITY_UNIT_NAME like CONCAT(CONCAT('%',#{accountname}),'%')

        </if>
    </select>

    <select id="xsegcexcel" resultType="map">
    SELECT
    company_id,
    nvl(companyname,'-')companyname,
    nvl("TO_CHAR"(FKDAT,'yyyy-mm'),'-') month,
    nvl("TO_CHAR"(fkdat,'yyyy-mm-dd'),'-')fkdat,
    nvl(fkimg,0)fkimg,
    nvl(kzwi6,0) kzwi6,
    nvl(kzwi6*fkimg,0) money,
    nvl(FKART,'-') FKART,
    nvl(order_type_describe,'-') order_type_describe,
    nvl(product_grade,'-') product_grade,
    nvl(sale_group,'-') sale_group,
    nvl(sale_body,'-') sale_body,
    nvl(ORDER_MOUNT,0) ORDER_MOUNT,
    nvl(DESTINATION_NAME,'-')DESTINATION_NAME,
    nvl(CONTRACT_NO,0)CONTRACT_NO,
    nvl(DJ_DATE,'-')DJ_DATE,
    nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
    nvl(name,'-') name,
    nvl(VARIETY,'-')VARIETY,
    nvl("TO_CHAR"(ACTUAL_DATE),'-')ACTUAL_DATE,
    nvl(product_line,'-') product_line,
    nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
    nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
    nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
    nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
    nvl(PAYER_NAME,'-') PAYER_NAME,
    nvl(SALE_PRICE,0) SALE_PRICE,
    nvl(VBELN,'-') VBELN,
    nvl(VGBEL,'-') VGBEL,
    nvl(VGPOS,'空') VGPOS,
    nvl(ORDER_NO,'-') ORDER_NO,
    nvl(ORDER_ROW,'-') ORDER_ROW,
    nvl(DZ_NAME,'-') DZ_NAME,
    nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
    nvl(ORDER_NOTE,'-') ORDER_NOTE
    from
    (SELECT
    company_id,
    nvl(companyname,'-')companyname,
    fkdat,
    fkimg,
    nvl(FKART,'-') FKART,
    nvl(order_type_describe,'-') order_type_describe,
    nvl(product_grade,'-') product_grade,
    nvl(sale_group,'-') sale_group,
    nvl(sale_body,'-') sale_body,
    nvl(ORDER_MOUNT,0) ORDER_MOUNT,
    DESTINATION_NAME,
    CONTRACT_NO,
    DJ_DATE,
    nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
    nvl(name,'-') name,
    nvl(VARIETY,'-')VARIETY,
    nvl(kzwi6,0) kzwi6,
    ACTUAL_DATE,
    nvl(product_line,'-') product_line,
    nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
    nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
    nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
    nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
    nvl(PAYER_NAME,'-') PAYER_NAME,
    nvl(SALE_PRICE,0) SALE_PRICE,
    nvl(VBELN,'-') VBELN,
    nvl(VGBEL,'-') VGBEL,
    nvl(VGPOS,'-') VGPOS,
    nvl(ORDER_NO,'-') ORDER_NO,
    nvl(ORDER_ROW,'-') ORDER_ROW,
    nvl(DZ_NAME,'-') DZ_NAME,

    nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
    nvl(ORDER_NOTE,'-') ORDER_NOTE
    from
    (SELECT distinct
    decode(settle.company_id,
    9580,
    '唐钢',
    9727,
    '邯钢',
    9193,
    '宣钢',
    9196,
    '承钢',
    1932,
    '舞钢',
    8110,
    '石钢',
    8493,
    '衡板',
    7778,
    '邯宝') AS companyname,
    settle.company_id,
    xsztdzb.sale_body,
    rpcl.product_grade,
    case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
    settle.fkdat,
    settle.FKART,
    settle.kzwi6,
    settle.VBELN,
    settle.VGBEL,
    settle.VGPOS,
    sso.DESTINATION_NAME,
    sso.CONTRACT_NO,
    sso.MATERIAL_INFO,
    sso.order_mount,
    sso.order_type_describe,
    sso.saler_name,
    sso.sale_group,
    sso.DJ_DATE,
    sso.ATTRIBUTE1,
    sso.ATTRIBUTE2,
    sso.ATTRIBUTE9,
    sso.ORDER_NO,
    sso.ORDER_ROW,
    sso.ORDER_NOTE,
    sso.PRODUCT_TYPE,
    sso.PAYER_NAME,
    sso.DZ_NAME,
    sso.PRODUCT_CODE,
    sso.sale_body ss,
    sso.SALE_PRICE,
    svtp.VARIETY,
    (select max(DATA.Name)
    from scm_delivery_detail detail
    JOIN crm_resource_data DATA
    ON DATA.full_name = detail.ext
    AND DATA.company_id = detail.company_id
    AND (DATA.TYPE = 6 )
    where settle.company_id = detail.company_id
    and settle.vgbel = detail.deliv_numb
    and settle.vgpos = detail.deliv_item
    and ( detail.delivery_delete  &lt; &gt; 'X' or
    detail.delivery_delete is null)) name,
    (select max(detail.ACTUAL_DATE)
    from scm_delivery_detail detail
    where settle.company_id = detail.company_id
    and settle.vgbel = detail.deliv_numb
    and settle.vgpos = detail.deliv_item
    and ( detail.delivery_delete  &lt; &gt; 'X'  or
    detail.delivery_delete is null))ACTUAL_DATE,
    (select max(detail.ext)
    from scm_delivery_detail detail
    where settle.company_id = detail.company_id
    and settle.vgbel = detail.deliv_numb
    and settle.vgpos = detail.deliv_item
    and ( detail.delivery_delete  &lt; &gt; 'X'  or
    detail.delivery_delete is null))product_line
    FROM scm_steel_settle settle

    left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso

    on settle.company_id = sso.company_id
    and settle.aubel = sso.order_no
    and settle.aupos = sso.order_row
    left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb

    ON sso.company_id = xsztdzb.company_id
    AND sso.sale_body = xsztdzb.sale_body_des

    inner join scm_variety_to_pt_gp svtp
    on sso.company_id = svtp.company_id
    and sso.product_code = svtp.product_group

    left join (SELECT a.company_id,
    a.product_class,
    a.product_line_class,
    a.product_class_crude,
    a.product_class_fine,
    a.product_grade
    FROM REPORT_PRODUCT_CLASS_LEVEL a
    where a.status = '0'
    union all
    SELECT b.company_id,
    b.second_code,
    b.product_line_class,
    b.product_class_crude,
    b.product_class_fine,
    b.product_grade
    FROM REPORT_PRODUCT_CLASS_LEVEL b
    where b.status = '0') rpcl
    on sso.company_id = rpcl.company_id
    and sso.product_type = rpcl.product_class
    where
    settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
    and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
    and  settle.company_id in ('9580','9727','9193')
    order by settle.id desc) t
    where t.order_type_describe not in
    (select distinct cfd.data_name
    from crm_filter_data cfd
    <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
        where cfd.data_type in ('5','10')


    </if>

    <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
        where cfd.data_type in ('10')


    </if>
    and cfd.status = '0'
    and cfd.company_id = t.company_id)
    and t.saler_name not in
    (select cfd.data_name
    from crm_filter_data cfd
    where cfd.data_type = '1'
    and cfd.status = '0'
    and cfd.company_id = t.company_id
    and instr(concat(t.product_line, t.company_id),
    concat(cfd.product_line, cfd.company_id))  &gt; 0)
    AND t.sale_group NOT IN (SELECT cfd.data_name
    FROM crm_filter_data cfd
    WHERE cfd.company_id = t.company_id
    AND cfd.data_type = 9
    AND cfd.status = 0)
    and t.sale_body is not null
        <if test="companyname != '' and companyname!= '全部' and companyname!= null and companyname != 'undefined'">

            and t.company_id = #{companyname}

        </if>
    UNION
    SELECT
    company_id ,
    nvl(companyname,'-')companyname,
    fkdat,
    fkimg,
    nvl(FKART,'-') FKART,
    nvl(order_type_describe,'-') order_type_describe,
    nvl(product_grade,'-') product_grade,
    nvl(sale_group,'-') sale_group,
    nvl(sale_body,'-') sale_body,
    nvl(ORDER_MOUNT,0) ORDER_MOUNT,
    DESTINATION_NAME,
    CONTRACT_NO,
    DJ_DATE,
    nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
    nvl(name,'-') name,
    nvl(VARIETY,'-')VARIETY,
    nvl(kzwi6,0) kzwi6,
    ACTUAL_DATE,

    nvl(product_line,'-') product_line,
    nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
    nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
    nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
    nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
    nvl(PAYER_NAME,'-') PAYER_NAME,
    nvl(SALE_PRICE,0) SALE_PRICE,
    nvl(VBELN,'-')  VBELN,
    nvl(VGBEL,'-') VGBEL,
    nvl(VGPOS,'-')  VGPOS,
    nvl(ORDER_NO,'-')  ORDER_NO,
    nvl(ORDER_ROW,'-') ORDER_ROW,
    nvl(DZ_NAME,'-') DZ_NAME,
    nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
    nvl(ORDER_NOTE,'-') ORDER_NOTE
    from (
    SELECT distinct
    decode(settle.company_id,
    9580,
    '唐钢',
    9727,
    '邯钢',
    9193,
    '宣钢',
    9196,
    '承钢',
    1932,
    '舞钢',
    8110,
    '石钢',
    8493,
    '衡板',
    7778,
    '邯宝') AS companyname,
    settle.company_id,
    xsztdzb.sale_body,
    rpcl.product_grade,
    case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
    settle.fkdat,
    settle.FKART,
    settle.kzwi6,
    sso.DJ_DATE,
    settle.VBELN,
    sso.DESTINATION_NAME,
    sso.CONTRACT_NO,
    settle.VGBEL,
    settle.VGPOS,
    sso.MATERIAL_INFO,
    sso.order_mount,
    sso.order_type_describe,
    sso.saler_name,
    sso.sale_group,
    sso.ATTRIBUTE1,
    sso.ATTRIBUTE2,
    sso.ATTRIBUTE9,
    sso.ORDER_NO,
    sso.ORDER_ROW,
    sso.ORDER_NOTE,
    sso.PRODUCT_TYPE,
    sso.PAYER_NAME,
    sso.DZ_NAME,
    sso.PRODUCT_CODE,
    sso.sale_body ss,
    sso.SALE_PRICE,
    svtp.VARIETY,
   (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) name,
    (select max(detail.ACTUAL_DATE)
    from scm_delivery_detail detail
    where settle.company_id = detail.company_id
    and settle.vgbel = detail.deliv_numb
    and settle.vgpos = detail.deliv_item
    and ( detail.delivery_delete  &lt; &gt; 'X'  or
    detail.delivery_delete is null))ACTUAL_DATE,
    (select max(detail.ext)
        from scm_delivery_detail detail
        where detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
    FROM scm_steel_settle settle
    left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
    on settle.company_id = sso.company_id
    and settle.aubel = sso.order_no
    and settle.aupos = sso.order_row
    left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
    ON sso.company_id = xsztdzb.company_id
    AND sso.sale_body = xsztdzb.sale_body_des
    inner join scm_variety_to_pt_gp svtp
    on sso.company_id = svtp.company_id
    and sso.product_code = svtp.product_group

    left join (SELECT a.company_id,
    a.product_class,
    a.product_line_class,
    a.product_class_crude,
    a.product_class_fine,
    a.product_grade
    FROM REPORT_PRODUCT_CLASS_LEVEL a
    where a.status = '0'
    union all
    SELECT b.company_id,
    b.second_code,
    b.product_line_class,
    b.product_class_crude,
    b.product_class_fine,
    b.product_grade
    FROM REPORT_PRODUCT_CLASS_LEVEL b
    where b.status = '0') rpcl
    on sso.company_id = rpcl.company_id
    and sso.product_type = rpcl.product_class
    where
    settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
    and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

    and  settle.company_id in ('9196')
    order by settle.id desc) t
    where t.order_type_describe not in
    (select distinct cfd.data_name
    from crm_filter_data cfd
    <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
        where cfd.data_type in ('5','10')


    </if>

    <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
        where cfd.data_type in ('10')


    </if>
    and cfd.status = '0'
    and cfd.company_id = t.company_id)
    and t.saler_name not in
    (select cfd.data_name
    from crm_filter_data cfd
    where cfd.data_type = '1'
    and cfd.status = '0'
    and cfd.company_id = t.company_id
    and instr(concat(t.product_line, t.company_id),
    concat(cfd.product_line, cfd.company_id))  &gt; 0)
    AND t.sale_group NOT IN (SELECT cfd.data_name
    FROM crm_filter_data cfd
    WHERE cfd.company_id = t.company_id
    AND cfd.data_type = 9
    AND cfd.status = 0)
    and t.sale_body is not null
        <if test="companyname != '' and companyname!= '全部' and companyname!= null and companyname != 'undefined'">

            and t.company_id = #{companyname}

        </if>
    UNION
    SELECT
    company_id,
    nvl(companyname,'-')companyname,
    fkdat,
    fkimg,
    nvl(FKART,'-') FKART,
    nvl(order_type_describe,'-') order_type_describe,
    nvl(product_grade,'-') product_grade,
    nvl(sale_group,'-') sale_group,
    nvl(sale_body,'-') sale_body,
    nvl(ORDER_MOUNT,0) ORDER_MOUNT,
    DESTINATION_NAME,
    CONTRACT_NO,
    DJ_DATE,
    nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
    nvl(name,'-')  name,
    nvl(VARIETY,'-')VARIETY,
    nvl(kzwi6,0) kzwi6,
    ACTUAL_DATE,
    nvl(product_line,'-') product_line,
    nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
    nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
    nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
    nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
    nvl(PAYER_NAME,'-')  PAYER_NAME,
    nvl(SALE_PRICE,0) SALE_PRICE,
    nvl(VBELN,'-') VBELN,
    nvl(VGBEL,'-')  VGBEL,
    nvl(VGPOS,'-')  VGPOS,
    nvl(ORDER_NO,'-')  ORDER_NO,
    nvl(ORDER_ROW,'-') ORDER_ROW,
    nvl(DZ_NAME,'-') DZ_NAME,
    nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
    nvl(ORDER_NOTE,'-') ORDER_NOTE
    from (
    SELECT distinct
    decode(settle.company_id,
    9580,
    '唐钢',
    9727,
    '邯钢',
    9193,
    '宣钢',
    9196,
    '承钢',
    1932,
    '舞钢',
    8110,
    '石钢',
    8493,
    '衡板',
    7778,
    '邯宝') AS companyname,
    settle.company_id,
    case when  settle.company_id='8110' then  sso.sale_body  else '' end  sggl,
    xsztdzb.sale_body ,
    rpcl.product_grade,
    case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
    settle.fkdat,
    settle.FKART,
    settle.kzwi6,
    settle.VBELN,
    settle.VGBEL,
    settle.VGPOS,
    sso.MATERIAL_INFO,
    sso.order_mount,
    sso.DESTINATION_NAME,
    sso.CONTRACT_NO,
    sso.order_type_describe,
    sso.saler_name,
    sso.sale_group,

    sso.DJ_DATE,
    sso.ATTRIBUTE1,
    sso.ATTRIBUTE2,
    sso.ATTRIBUTE9,
    sso.ORDER_NO,
    sso.ORDER_ROW,
    sso.ORDER_NOTE,
    sso.PRODUCT_TYPE,
    sso.PAYER_NAME,
    sso.DZ_NAME,
    sso.PRODUCT_CODE,
    sso.SALE_PRICE,
    svtp.VARIETY,
    decode(settle.company_id,
    1932,
    '宽厚板',
    8110,
    '特钢',
    8493,
    '薄板') AS name,
    (select max(detail.ACTUAL_DATE)
    from scm_delivery_detail detail
    where settle.company_id = detail.company_id
    and settle.vgbel = detail.deliv_numb
    and settle.vgpos = detail.deliv_item
    and ( detail.delivery_delete  &lt; &gt; 'X'  or
    detail.delivery_delete is null))ACTUAL_DATE,
    (select max(detail.ext)
    from scm_delivery_detail detail
    where settle.company_id = detail.company_id
    and settle.vgbel = detail.deliv_numb
    and settle.vgpos = detail.deliv_item
    and ( detail.delivery_delete  &lt; &gt; 'X'  or
    detail.delivery_delete is null))product_line
    FROM scm_steel_settle settle
    left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
    on settle.company_id = sso.company_id
    and settle.aubel = sso.order_no
    and settle.aupos = sso.order_row
    left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
    ON sso.company_id = xsztdzb.company_id
    AND sso.sale_body = xsztdzb.sale_body_des
    inner join scm_variety_to_pt_gp svtp
    on sso.company_id = svtp.company_id
    and sso.product_code = svtp.product_group

    left join (SELECT a.company_id,
    a.product_class,
    a.product_line_class,
    a.product_class_crude,
    a.product_class_fine,
    a.product_grade
    FROM REPORT_PRODUCT_CLASS_LEVEL a
    where a.status = '0'
    union all
    SELECT b.company_id,
    b.second_code,
    b.product_line_class,
    b.product_class_crude,
    b.product_class_fine,
    b.product_grade
    FROM REPORT_PRODUCT_CLASS_LEVEL b
    where b.status = '0') rpcl
    on sso.company_id = rpcl.company_id
    and sso.product_type = rpcl.product_class
    where
    settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
    and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
    and  settle.company_id in ('8110','8493','1932')

    order by settle.id desc) t
    where t.order_type_describe not in
    (select distinct cfd.data_name
    from crm_filter_data cfd
    <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
        where cfd.data_type in ('5','10')
    </if>

    <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
        where cfd.data_type in ('10')


    </if>
    and cfd.status = '0'
    and cfd.company_id = t.company_id)
    and t.saler_name not in
    (select cfd.data_name
    from crm_filter_data cfd
    where cfd.data_type = '1'
    and cfd.status = '0'
    and cfd.company_id = t.company_id
    and instr(concat(t.product_line, t.company_id),
    concat(cfd.product_line, cfd.company_id))  &gt; 0)
    AND t.sale_group NOT IN (SELECT cfd.data_name
    FROM crm_filter_data cfd
    WHERE cfd.company_id = t.company_id
    AND cfd.data_type = 9
    AND cfd.status = 0)
    and (
        t.sggl = '分公司'
        or t.sggl = '出口'
        or t.sale_group = '销售部'
        or  t.sale_group = '营销中心'
        or  t.sale_group ='1000'
        or  t.sale_group = '科技部'
        or  t.sale_group = '舞钢国贸')

        <if test="companyname != '' and companyname!= '全部' and companyname!= null and companyname != 'undefined'">

            and t.company_id = #{companyname}

        </if>
    )
    ORDER BY decode(companyname,'唐钢','邯钢','宣钢','承钢','舞钢','石钢','衡板','邯宝')

</select>
    <select id="xsecxexcel" resultType="map">
        SELECT
        company_id,
        nvl(companyname,'-')companyname,
        nvl("TO_CHAR"(FKDAT,'yyyy-mm'),'-') month,
        nvl("TO_CHAR"(fkdat,'yyyy-mm-dd'),'-')fkdat,
        nvl(fkimg,0)fkimg,
        nvl(kzwi6,0) kzwi6,
        nvl(kzwi6*fkimg,0) money,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        nvl(DESTINATION_NAME,'-')DESTINATION_NAME,
        nvl(CONTRACT_NO,0)CONTRACT_NO,
        nvl(DJ_DATE,'-')DJ_DATE,
        nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
        nvl(name,'-') name,
        nvl(VARIETY,'-')VARIETY,
        nvl("TO_CHAR"(ACTUAL_DATE),'-')ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'空') VGPOS,
        nvl(ORDER_NO,'-') ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from
        (SELECT
        company_id,
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
        case when cxname is null then  '其他' end name,
        vc.VARIETY_CLASS VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'-') VGPOS,
        nvl(ORDER_NO,'-') ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from
        (SELECT distinct
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        settle.VBELN,
        settle.VGBEL,
        settle.VGPOS,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.DJ_DATE,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.sale_body ss,
        sso.SALE_PRICE,
        svtp.VARIETY,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle

        left join (select * from scm_sale_order where  deleted &lt; &gt; 'X'  or  deleted is  null) sso

        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb

        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des

        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('9580','9727','9193')
        ) t
        right JOIN SCM_VARIETY_CLASS vc
        on t.cxname = vc.name
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd

        <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('5','10')


        </if>

        <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('10')


        </if>







        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)


        UNION
        SELECT
        company_id ,
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
        nvl(cxname,'-') name,
        vc.VARIETY_CLASS VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,

        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-')  VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'-')  VGPOS,
        nvl(ORDER_NO,'-')  ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from (
        SELECT distinct
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        sso.DJ_DATE,
        settle.VBELN,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        settle.VGBEL,
        settle.VGPOS,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.sale_body ss,
        sso.SALE_PRICE,
        svtp.VARIETY,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join (select * from scm_sale_order where  deleted &lt; &gt; 'X'  or  deleted is  null) sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

        and  settle.company_id in ('9196')) t
        right JOIN SCM_VARIETY_CLASS vc
        on t.cxname = vc.name
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd

        <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('5','10')


        </if>

        <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('10')


        </if>





        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.sale_body is not null

        UNION
        SELECT
        company_id,
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
        nvl(cxname,'-')  name,
        case when  company_id ='1932' then '中厚板'
        when  company_id ='8110' then  '圆钢'
        when  company_id ='8493' then '薄板' end  VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
        nvl(PAYER_NAME,'-')  PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-')  VGBEL,
        nvl(VGPOS,'-')  VGPOS,
        nvl(ORDER_NO,'-')  ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from (
        SELECT distinct
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        case when  settle.company_id='8110' then  sso.sale_body  else '' end  sggl,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        settle.VBELN,
        settle.VGBEL,
        settle.VGPOS,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,

        sso.DJ_DATE,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.SALE_PRICE,
        svtp.VARIETY,
        decode(settle.company_id,
        1932,
        '舞钢中厚板',
        8110,
        '石钢圆钢',
        8493,
        '衡板薄板') AS cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join (select * from scm_sale_order where  deleted &lt; &gt; 'X'  or  deleted is  null) sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        ) t
        right JOIN SCM_VARIETY_CLASS vc
        on t.cxname = vc.name
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd

        <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('5','10')


        </if>

        <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('10')


        </if>





        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and (
        t.sggl = '分公司'
        or t.sggl = '出口'
        or t.sale_group = '销售部'
        or  t.sale_group = '营销中心'
        or  t.sale_group ='1000'
        or  t.sale_group = '科技部'
        or  t.sale_group = '舞钢国贸')


        )
        where 1=1
        <if test="pz != '' and pz!= '全部' and pz!= null and pz != 'undefined'">

            and VARIETY = #{pz}

        </if>
        <if test="cx != null and  cx.size > 0">
            and   name in
            <foreach item="item" index="index" collection="cx" open="(" separator="," close=")">
                　　#{item}
            </foreach>
        </if>

        ORDER BY decode(companyname,'唐钢','邯钢','宣钢','承钢','舞钢','石钢','衡板','邯宝')





    </select>
    <select id="xsepzexcel" resultType="map">

        SELECT
        nvl(companyname,'-') companyname,
        nvl("TO_CHAR"(FKDAT,'yyyy-mm'),'-') month,
        nvl("TO_CHAR"(fkdat,'yyyy-mm-dd'),'-') fkdat,
        nvl(fkimg,0) fkimg,
        nvl(kzwi6,0) kzwi6,
        nvl(kzwi6*fkimg,0) money,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        nvl(DESTINATION_NAME,'-') DESTINATION_NAME,
        nvl(CONTRACT_NO,0) CONTRACT_NO,
        nvl(DJ_DATE,'-') DJ_DATE,
        nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
        nvl(cxname,'-') cxname,
        nvl(VARIETY,'-') VARIETY,
        nvl("TO_CHAR"(ACTUAL_DATE),'-') ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'空') VGPOS,
        nvl(ORDER_NO,'-') ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from
        (SELECT
        nvl(companyname,'null')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'null') FKART,
        nvl(order_type_describe,'null') order_type_describe,
        nvl(product_grade,'null') product_grade,
        nvl(sale_group,'null') sale_group,
        nvl(sale_body,'null') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
        nvl(cxname,'-') cxname,
        nvl(VC.VARIETY_CLASS,'-')VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'-') VGPOS,
        nvl(ORDER_NO,'-') ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,

        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from
        (SELECT
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        settle.VBELN,
        settle.VGBEL,
        settle.VGPOS,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.DJ_DATE,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.sale_body ss,
        sso.SALE_PRICE,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle

        left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso

        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb

        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des

        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        LEFT JOIN SCM_VARIETY_CLASS vc
        on t.cxname = vc.name
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('5','10')


        </if>

        <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('10')


        </if>
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        UNION
        SELECT
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
        nvl(cxname,'-') cxname,
        nvl(VC.VARIETY_CLASS,'-')VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,

        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-')  VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'-')  VGPOS,
        nvl(ORDER_NO,'-')  ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from (
        SELECT
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        sso.DJ_DATE,
        settle.VBELN,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        settle.VGBEL,
        settle.VGPOS,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.sale_body ss,
        sso.SALE_PRICE,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        LEFT JOIN SCM_VARIETY_CLASS vc
        on t.cxname = vc.name
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('5','10')


        </if>

        <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('10')


        </if>
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        UNION
        SELECT
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
        nvl(cxname,'-')  cxname,
        nvl(VARIETY,'-')VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
        nvl(PAYER_NAME,'-')  PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-')  VGBEL,
        nvl(VGPOS,'-')  VGPOS,
        nvl(ORDER_NO,'-')  ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from (
        SELECT
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        sso.sale_body ,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        settle.VBELN,
        settle.VGBEL,
        settle.VGPOS,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,

        sso.DJ_DATE,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.SALE_PRICE,
        (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) VARIETY,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        <if test="jd != '' and jd == 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('5','10')


        </if>

        <if test="jd != '' and jd != 0 and jd!= null and jd != 'undefined'">
            where cfd.data_type in ('10')


        </if>
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        )
        where 1 = 1
        <if test="pz != '' and pz!= '全部' and pz!= null and pz != 'undefined'">

            and VARIETY = #{pz}

        </if>
        ORDER BY decode(companyname,'唐钢','邯钢','宣钢','承钢','舞钢','石钢','衡板','邯宝')



    </select>
    <select id="xsecxfbexcel" resultType="map">

        SELECT
        nvl(companyname,'-') companyname,
        nvl("TO_CHAR"(FKDAT,'yyyy-mm'),'-') month,
        nvl("TO_CHAR"(fkdat,'yyyy-mm-dd'),'-') fkdat,
        nvl(fkimg,0) fkimg,
        nvl(kzwi6,0) kzwi6,
        nvl(kzwi6*fkimg,0) money,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        nvl(DESTINATION_NAME,'-') DESTINATION_NAME,
        nvl(CONTRACT_NO,0) CONTRACT_NO,
        nvl(DJ_DATE,'-') DJ_DATE,
        nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
        nvl(cxname,'-') cxname,
        nvl(VARIETY,'-') VARIETY,
        nvl("TO_CHAR"(ACTUAL_DATE),'-') ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'空') VGPOS,
        nvl(ORDER_NO,'-') ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from
        (SELECT
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-') PRODUCT_TYPE,
        nvl(cxname,'-') cxname,
        nvl(VARIETY,'-')VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-') MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'-') VGPOS,
        nvl(ORDER_NO,'-') ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,

        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from
        (SELECT
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        settle.VBELN,
        settle.VGBEL,
        settle.VGPOS,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.DJ_DATE,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.sale_body ss,
        sso.SALE_PRICE,
        (select max(B.VARIETY)
        from (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) VARIETY,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle

        left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso

        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb

        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des

        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        UNION
        SELECT
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
        nvl(cxname,'-') cxname,
        nvl(VARIETY,'-')VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,

        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
        nvl(PAYER_NAME,'-') PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-')  VBELN,
        nvl(VGBEL,'-') VGBEL,
        nvl(VGPOS,'-')  VGPOS,
        nvl(ORDER_NO,'-')  ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from (
        SELECT
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        sso.DJ_DATE,
        settle.VBELN,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        settle.VGBEL,
        settle.VGPOS,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.sale_body ss,
        sso.SALE_PRICE,
        (select max(B.VARIETY)
        from (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) VARIETY,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        UNION
        SELECT
        nvl(companyname,'-')companyname,
        fkdat,
        fkimg,
        nvl(FKART,'-') FKART,
        nvl(order_type_describe,'-') order_type_describe,
        nvl(product_grade,'-') product_grade,
        nvl(sale_group,'-') sale_group,
        nvl(sale_body,'-') sale_body,
        nvl(ORDER_MOUNT,0) ORDER_MOUNT,
        DESTINATION_NAME,
        CONTRACT_NO,
        DJ_DATE,
        nvl(PRODUCT_TYPE,'-')  PRODUCT_TYPE,
        nvl(cxname,'-')  cxname,
        nvl(VARIETY,'-')VARIETY,
        nvl(kzwi6,0) kzwi6,
        ACTUAL_DATE,
        nvl(product_line,'-') product_line,
        nvl(ATTRIBUTE1,'-') ATTRIBUTE1,
        nvl(ATTRIBUTE2,'-') ATTRIBUTE2,
        nvl(ATTRIBUTE9,'-') ATTRIBUTE9,
        nvl(MATERIAL_INFO,'-')  MATERIAL_INFO,
        nvl(PAYER_NAME,'-')  PAYER_NAME,
        nvl(SALE_PRICE,0) SALE_PRICE,
        nvl(VBELN,'-') VBELN,
        nvl(VGBEL,'-')  VGBEL,
        nvl(VGPOS,'-')  VGPOS,
        nvl(ORDER_NO,'-')  ORDER_NO,
        nvl(ORDER_ROW,'-') ORDER_ROW,
        nvl(DZ_NAME,'-') DZ_NAME,
        nvl(PRODUCT_CODE,'-') PRODUCT_CODE,
        nvl(ORDER_NOTE,'-') ORDER_NOTE
        from (
        SELECT
        decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        sso.sale_body ,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.fkdat,
        settle.FKART,
        settle.kzwi6,
        settle.VBELN,
        settle.VGBEL,
        settle.VGPOS,
        sso.MATERIAL_INFO,
        sso.order_mount,
        sso.DESTINATION_NAME,
        sso.CONTRACT_NO,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,

        sso.DJ_DATE,
        sso.ATTRIBUTE1,
        sso.ATTRIBUTE2,
        sso.ATTRIBUTE9,
        sso.ORDER_NO,
        sso.ORDER_ROW,
        sso.ORDER_NOTE,
        sso.PRODUCT_TYPE,
        sso.PAYER_NAME,
        sso.DZ_NAME,
        sso.PRODUCT_CODE,
        sso.SALE_PRICE,
        (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) VARIETY,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) cxname,
        (select max(detail.ACTUAL_DATE)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))ACTUAL_DATE,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join (select * from scm_sale_order where  deleted &lt;&gt; 'X'  or  deleted is  null) sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        )
        where 1 = 1
        <if test="zl != '' and  zl != null and  zl != 'undefined' and zl !='全部'">
            and VARIETY = #{zl}
        </if>
        <if test="cx != null and  cx.size > 0">
            and   CXNAME in
            <foreach item="item" index="index" collection="cx" open="(" separator="," close=")">
                　　#{item}
            </foreach>
        </if>
        ORDER BY decode(companyname,'唐钢','邯钢','宣钢','承钢','舞钢','石钢','衡板','邯宝')



    </select>
</mapper>
