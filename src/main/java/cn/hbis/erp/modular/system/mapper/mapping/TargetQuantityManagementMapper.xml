<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hbis.erp.modular.system.mapper.TargetQuantityManagementMapper">

    <sql id="Base_Column_List">
        TQ.TARGET_QUANTITY_MANAGEMENT_ID AS ID,TQ."YEAR",AM.ACCOUNTABILITY_UNIT_NAME AS "NAME" ,JANUARY,FEBRUARY,MARCH,APRIL,MAY,JUNE,JULY,AUGUST,SEPTEMBER,OCTOBER,NOVEMBER,DECEMBER
    </sql>
    <select id="selTargetManagement" parameterType="String" resultType="map">
        select
        <include refid="Base_Column_List"/>
        from SCM_TARGET_QUANTITY_MANAGEMENT TQ
        LEFT JOIN
        SCM_ACCOUNTABILITY_UNIT_MANAGE AM
        ON
        AM.ACCOUNTABILITY_UNIT_CODE = TQ.RESPONSIBILITY_UNIT
        where TQ.DELETESTATUS = '0'
        AND AM.DELETESTATUS = '0'
        <if test="targetname != null and targetname !=''">

            and RESPONSIBILITY_UNIT like CONCAT(CONCAT('%',#{targetname}),'%')

        </if>
        <if test="year != null and year !=''">

            and YEAR like CONCAT(CONCAT('%',#{year}),'%')

        </if>
    </select>
    <select id="getlist" resultType="map">
		select sa.ACCOUNTABILITY_UNIT_CODE code,sa.ACCOUNTABILITY_UNIT_NAME NAME
		from SCM_ACCOUNTABILITY_UNIT_MANAGE  sa
		WHERE sa.DELETESTATUS = '0'
	</select>
    <select id="selectscaaccnuitList" resultType="map">
        select ACCOUNTABILITY_UNIT_ID AS ID,ACCOUNTABILITY_UNIT_CODE AS CODE,ACCOUNTABILITY_UNIT_NAME AS "NAME"
        from SCM_ACCOUNTABILITY_UNIT_MANAGE
        where DELETESTATUS = '0'
    </select>
    <select id="theList" resultType="map">
        select RESPONSIBILITY_UNIT AS CODE
        from SCM_TARGET_QUANTITY_MANAGEMENT
        where DELETESTATUS = '0' ORDER BY RESPONSIBILITY_UNIT
    </select>
    <!-- 一 -->
    <select id="salesmainsum" resultType="map">
        SELECT "SUM"(zyfkimg) zyfkimg from
        (
        SELECT a.FL_name companyname,NVL("SUM"(JHL),0) zyfkimg from
        ( select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE rq like #{year}||'%' and yf = 3
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        where a.FL_Name ='内贸' or a.FL_Name ='出口' or a.FL_Name ='技术中心、事业部' or a.FL_Name ='销售总公司'

        GROUP BY a.FL_NAME

        )

    </select>
    <select id="salesmain" resultType="map">
        SELECT a.FL_name companyname,NVL("SUM"(JHL),0) zyfkimg from
        ( select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE rq LIKE #{year}||'%' and
        yf = 3
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        where a.FL_Name ='内贸' or a.FL_Name ='出口' or a.FL_Name ='技术中心、事业部' or a.FL_Name ='销售总公司'

        GROUP BY a.FL_NAME

    </select>

    <!--三-->
    <select id="typeselect" resultType="map">
		SELECT a.pz name,a.pzgl ,b.jsl ,"ROUND"(a.pzgl/b.jsl, 2)*100 bili  from
(SELECT Pz, "SUM"(jhl) pzgl from
(select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3 AND FL_name ='品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
GROUP BY pz ) a
LEFT JOIN (
SELECT Pz, "SUM"(jhl) jsl from
(
select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
		)
		GROUP BY pz ) b
		on a.pz = b.pz


	</select>
    <select id="typessum" resultType="map">
		SELECT sum(pzgl) pzgl,"SUM"(jsl) jsl, "ROUND"((sum(pzgl)/"SUM"(jsl))*100, 2)|| '%'  bili
		from
		(	SELECT a.pz name,a.pzgl ,b.jsl ,"ROUND"(a.pzgl/b.jsl, 2)*100 bili  from
(SELECT Pz, "SUM"(jhl) pzgl from
(select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3 AND FL_name ='品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
GROUP BY pz ) a
LEFT JOIN (
SELECT Pz, "SUM"(jhl) jsl from
(
select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
		)
		GROUP BY pz ) b
		on a.pz = b.pz

		)

	</select>

    <!-- 二 -->
    <select id="Steelmillsplan" resultType="map">
        SELECT
        DECODE( m.COMPANy_id,9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') companyname,"NVL"("SUM"(s.JHL),0) jh,NVL("SUM"(s.XH),0) xh from

        ( SELECT a.cx,a.jhl,b.XH from
        ( SELECT cx ,"SUM"(jhl) jhl from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = 3
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx  ) a
        LEFT JOIN
        (SELECT cx ,"SUM"(jhl) xh from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = 3 and FL_name = '现货'
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>


        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx   ) b
        on a.cx= b.CX ) s
        LEFT JOIN
        (SELECT "DATA"."NAME",DETAIL.COMPANY_ID from

        scm_delivery_detail detail
        LEFT JOIN
        CRM_RESOURCE_DATA DATA
        on   data.full_name = detail.ext AND
        data.company_id =

        detail.company_id
        and	data.type = 3
        where data.name is not null
        GROUP BY "DATA"."NAME",DETAIL.COMPANY_ID) m
        on s.CX = m.name
        where  m.company_id is not null
        GROUP BY m.company_id

    </select>
    <select id="Steelmillssum" resultType="map">
        SELECT "SUM"(xh) xh,"SUM"(jh) jh from
        ( SELECT
        DECODE( m.COMPANy_id,9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') companyname,"NVL"("SUM"(s.JHL),0) jh,NVL("SUM"(s.XH),0) xh from

        ( SELECT a.cx,a.jhl,b.XH from
        ( SELECT cx ,"SUM"(jhl) jhl from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = 3
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx  ) a
        LEFT JOIN
        (SELECT cx ,"SUM"(jhl) xh from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = 3 and FL_name = '现货'
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>


        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx   ) b
        on a.cx= b.CX ) s
        LEFT JOIN
        (SELECT "DATA"."NAME",DETAIL.COMPANY_ID from

        scm_delivery_detail detail
        LEFT JOIN
        CRM_RESOURCE_DATA DATA
        on   data.full_name = detail.ext AND
        data.company_id =

        detail.company_id
        and	data.type = 3
        where data.name is not null
        GROUP BY "DATA"."NAME",DETAIL.COMPANY_ID) m
        on s.CX = m.name
        where  m.company_id is not null
        GROUP BY m.company_id
        )

    </select>
    <!--四-->
    <select id="Steellist" resultType="map">
						SELECT "DECODE"(m.company_id,9580,
						'唐钢',
						9727,
						'邯钢',
						9193,
						'宣钢',
						9196,
						'承钢',
						1932,
						'舞钢',
						8110,
						'石钢',
						8493,
						'衡板',
						7778,
						'邯宝' ) companyname,

		NVL("SUM"(x.JSL),0) jsl,NVL("SUM"(x.PZGL),0) pzgl

		,"ROUND"("SUM"(x.PZGL)/"SUM"(x.JSL), 4)*100 bili from
		(
		SELECT s.CX,s.JSL,x.PZGL from
		(SELECT cx ,"SUM"(jhl) jsl from
				(select *
				  from (select '1' yf,year || '1月'

		rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '2' yf,year || '2月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '3' yf,year || '3月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '4' yf,year || '4月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '5' yf,year || '5月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH)

		jhl
						  from

		crm_resource_allocation
							  where STATUS =

		'0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '6' yf,year || '6月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '7' yf,year || '7月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '8' yf,year || '8月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '9' yf,year || '9月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '10' yf,year || '10

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '11' yf,year || '11

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH)

		jhl
						  from

		crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '12' yf,year || '12

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and

		yf = 3 AND FL_name <![CDATA[ != ]]>  '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷

		板','宽厚板','棒线','型材') ) a
							GROUP BY cx ) s
		LEFT JOIN
		(SELECT cx ,"SUM"(jhl) pzgl from
				(select *
				  from (select '1' yf,year || '1月'

		rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '2' yf,year || '2月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '3' yf,year || '3月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '4' yf,year || '4月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '5' yf,year || '5月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH)

		jhl
						  from

		crm_resource_allocation
							  where STATUS =

		'0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '6' yf,year || '6月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '7' yf,year || '7月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '8' yf,year || '8月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '9' yf,year || '9月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '10' yf,year || '10

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '11' yf,year || '11

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH)

		jhl
						  from

		crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '12' yf,year || '12

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and

		yf = 3 AND FL_name = '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷

		板','宽厚板','棒线','型材') ) a
							GROUP BY cx  ) x
		on s.CX= x.CX
		) x
		LEFT JOIN
		(SELECT "DATA"."NAME",DETAIL.COMPANY_ID from

		scm_delivery_detail detail
		LEFT JOIN
		  CRM_RESOURCE_DATA DATA
		on   data.full_name = detail.ext AND
					data.company_id =

		detail.company_id
				and	data.type = 3
		where data.name is not null
		GROUP BY "DATA"."NAME",DETAIL.COMPANY_ID) m
		on x.CX = m.name
		where  m.company_id is not null
		 GROUP BY m.company_id
	</select>
    <select id="Steelsum" resultType="map">
		SELECT NVL("SUM"(pzgl),0) pzgl,NVL("SUM"(jsl),0) jsl from (SELECT "DECODE"(m.company_id,9580,
						'唐钢',
						9727,
						'邯钢',
						9193,
						'宣钢',
						9196,
						'承钢',
						1932,
						'舞钢',
						8110,
						'石钢',
						8493,
						'衡板',
						7778,
						'邯宝' ) companyname,

		"SUM"(x.JSL) jsl,"SUM"(x.PZGL) pzgl

		,"ROUND"("SUM"(x.PZGL)/"SUM"(x.JSL), 4)*100 bili from
		(
		SELECT s.CX,s.JSL,x.PZGL from
		(SELECT cx ,"SUM"(jhl) jsl from
				(select *
				  from (select '1' yf,year || '1月'

		rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '2' yf,year || '2月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '3' yf,year || '3月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '4' yf,year || '4月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '5' yf,year || '5月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH)

		jhl
						  from

		crm_resource_allocation
							  where STATUS =

		'0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '6' yf,year || '6月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '7' yf,year || '7月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '8' yf,year || '8月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '9' yf,year || '9月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '10' yf,year || '10

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '11' yf,year || '11

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH)

		jhl
						  from

		crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '12' yf,year || '12

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and

		yf = 3 AND FL_name <![CDATA[ != ]]>  '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷

		板','宽厚板','棒线','型材') ) a
							GROUP BY cx ) s
		LEFT JOIN
		(SELECT cx ,"SUM"(jhl) pzgl from
				(select *
				  from (select '1' yf,year || '1月'

		rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '2' yf,year || '2月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '3' yf,year || '3月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '4' yf,year || '4月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '5' yf,year || '5月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH)

		jhl
						  from

		crm_resource_allocation
							  where STATUS =

		'0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '6' yf,year || '6月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '7' yf,year || '7月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '8' yf,year || '8月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH)

		jhl
						  from

		crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '9' yf,year || '9月

		' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '10' yf,year || '10

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '11' yf,year || '11

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH)

		jhl
						  from

		crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name
						union all
						select '12' yf,year || '12

		月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH)

		jhl
						  from

		crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,

		cx_name, fl_name) a
						WHERE  rq LIKE  #{year}||'%' and

		yf = 3 AND FL_name = '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷

		板','宽厚板','棒线','型材') ) a
							GROUP BY cx  ) x
		on s.CX= x.CX
		) x
		LEFT JOIN
		(SELECT "DATA"."NAME",DETAIL.COMPANY_ID from

		scm_delivery_detail detail
		LEFT JOIN
		  CRM_RESOURCE_DATA DATA
		on   data.full_name = detail.ext AND
					data.company_id =

		detail.company_id
				and	data.type = 3
		where data.name is not null
		GROUP BY "DATA"."NAME",DETAIL.COMPANY_ID) m
		on x.CX = m.name
		where  m.company_id is not null
		 GROUP BY m.company_id
		)

	</select>


</mapper>
