<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hbis.erp.modular.system.mapper.TargetQuantityManagementMapper">

    <sql id="Base_Column_List">
        TQ.TARGET_QUANTITY_MANAGEMENT_ID AS ID,TQ."YEAR",AM.ACCOUNTABILITY_UNIT_NAME AS "NAME" ,JANUARY,FEBRUARY,MARCH,APRIL,MAY,JUNE,JULY,AUGUST,SEPTEMBER,OCTOBER,NOVEMBER,DECEMBER
    </sql>
    <select id="selTargetManagement" parameterType="String" resultType="map">
        select
        <include refid="Base_Column_List"/>
        from SCM_TARGET_QUANTITY_MANAGEMENT TQ
        LEFT JOIN
        SCM_ACCOUNTABILITY_UNIT_MANAGE AM
        ON
        AM.ACCOUNTABILITY_UNIT_CODE = TQ.RESPONSIBILITY_UNIT
        where TQ.DELETESTATUS = '0'
        AND AM.DELETESTATUS = '0'
        <if test="targetname != null and targetname !=''">

            and RESPONSIBILITY_UNIT like CONCAT(CONCAT('%',#{targetname}),'%')

        </if>
        <if test="year != null and year !=''">

            and YEAR like CONCAT(CONCAT('%',#{year}),'%')

        </if>
    </select>
    <select id="getlist" resultType="map">
		select sa.ACCOUNTABILITY_UNIT_CODE code,sa.ACCOUNTABILITY_UNIT_NAME NAME
		from SCM_ACCOUNTABILITY_UNIT_MANAGE  sa
		WHERE sa.DELETESTATUS = '0'
	</select>
    <select id="selectscaaccnuitList" resultType="map">
        select ACCOUNTABILITY_UNIT_ID AS ID,ACCOUNTABILITY_UNIT_CODE AS CODE,ACCOUNTABILITY_UNIT_NAME AS "NAME"
        from SCM_ACCOUNTABILITY_UNIT_MANAGE
        where DELETESTATUS = '0'
    </select>
    <select id="theList" resultType="map">
        select RESPONSIBILITY_UNIT AS CODE
        from SCM_TARGET_QUANTITY_MANAGEMENT
        where DELETESTATUS = '0' ORDER BY RESPONSIBILITY_UNIT
    </select>
    <!-- 一 -->
    <select id="salesmainsum" resultType="map">
        SELECT "SUM"(zyfkimg) zyfkimg from
        (
        SELECT a.FL_name companyname,NVL("SUM"(JHL),0) zyfkimg from
        ( select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE rq LIKE  #{year}||'%' and
        yf = #{month}
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        where a.FL_Name ='内贸' or a.FL_Name ='出口' or a.FL_Name ='技术中心、事业部' or a.FL_Name ='销售总公司'
        or a.FL_name ='现货'
        GROUP BY a.FL_NAME
        )

    </select>
    <select id="salesmain" resultType="map">
        SELECT a.FL_name companyname,NVL("SUM"(JHL),0) zyfkimg from
        ( select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE rq LIKE  #{year}||'%' and
        yf = #{month}
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        where a.FL_Name ='内贸' or a.FL_Name ='出口' or a.FL_Name ='技术中心、事业部' or a.FL_Name ='销售总公司'
        or a.FL_name ='现货'
        GROUP BY a.FL_NAME
    </select>

    <!--三-->
    <select id="typeselect" resultType="map">
		SELECT a.pz name,NVL(a.pzgl,0) pzgl,NVL(b.jsl,0) jsl ,NVL("ROUND"(a.pzgl/b.jsl, 2)*100,0) bili  from
(SELECT Pz, "SUM"(jhl) pzgl from
(select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = #{month} AND FL_name ='品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
GROUP BY pz ) a
LEFT JOIN (
SELECT Pz, "SUM"(jhl) jsl from
(
select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = #{month} AND FL_name <![CDATA[ != ]]>  '品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
		)
		GROUP BY pz ) b
		on a.pz = b.pz


	</select>
    <select id="typessum" resultType="map">
		SELECT NVL(sum(pzgl),0) pzgl,"SUM"(jsl) jsl, NVL("ROUND"((sum(pzgl)/"SUM"(jsl))*100, 2),0)|| '%'  bili
		from
		(SELECT a.pz name,a.pzgl ,b.jsl ,"ROUND"(a.pzgl/b.jsl, 2)*100 bili  from
(SELECT Pz, "SUM"(jhl) pzgl from
(select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = #{month} AND FL_name ='品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
GROUP BY pz ) a
LEFT JOIN (
SELECT Pz, "SUM"(jhl) jsl from
(
select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = #{month} AND FL_name <![CDATA[ != ]]>  '品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
		)
		GROUP BY pz ) b
		on a.pz = b.pz

		)

	</select>

    <!-- 二 -->
    <select id="Steelmillsplan" resultType="map">

        SELECT  DECODE( COMPANY_ID,9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') companyname,"SUM"(jhl)jh,NVL("SUM"(xh),0) xh FROM
        (SELECT  case
        when a.cx = '唐钢1700/1810' then'9580'
        when a.cx = '唐钢酸洗' then'9580'
        when a.cx = '唐钢一冷罩退' then'9580'
        when a.cx = '唐钢热基镀锌' then'9580'
        when a.cx = '唐钢一冷冷基镀锌' then'9580'
        when a.cx = '唐钢一冷酸轧' then'9580'
        when a.cx = '唐钢二冷酸轧' then'9580'
        when a.cx = '唐钢新区连退' then'9580'
        when a.cx = '唐钢新区镀锌' then'9580'
        when a.cx = '唐钢棒材' then'9580'
        when a.cx = '唐钢线材' then'9580'
        when a.cx = '唐钢中型' then'9580'
        when a.cx = '唐钢1580热轧线' then'9580'
        when a.cx = '唐钢中厚板' then'9580'
        when a.cx = '唐钢大型' then'9580'
        when a.cx = '唐钢中厚板' then'9580'
        when a.cx = '邯钢2250' then'7778'
        when a.cx = '邯宝酸轧' then'7778'
        when a.cx = '邯钢西区镀锌' then'7778'
        when a.cx = '邯钢西区连退' then'7778'
        when a.cx = '邯钢CSP' then'9727'
        when a.cx = '邯钢酸洗' then'9727'
        when a.cx = '邯钢一冷罩退' then'9727'
        when a.cx = '邯钢热基镀锌' then'9727'
        when a.cx = '邯钢一冷冷基镀锌' then'9727'
        when a.cx = '邯钢电镀锌' then'9727'
        when a.cx = '邯钢彩涂' then'9727'
        when a.cx = '邯钢酸轧' then'9727'
        when a.cx = '邯钢3000/3500' then'9727'
        when a.cx = '邯钢棒材' then'9727'
        when a.cx = '邯钢线材' then'9727'
        when a.cx = '邯钢新钢轧线材' then'9727'
        when a.cx = '邯钢新钢轧棒材' then'9727'
        when a.cx = '邯钢新钢轧型材' then'9727'
        when a.cx = '宣钢棒材' then'9193'
        when a.cx = '宣钢一高线、二高线' then'9193'
        when a.cx = '宣钢中型' then'9193'
        when a.cx = '宣钢带钢' then'9193'
        when a.cx = '承钢1780' then'9196'
        when a.cx = '承钢棒材' then'9196'
        when a.cx = '承钢线材' then'9196'
        when a.cx = '承钢中宽带' then'9196'
        when a.cx = '舞钢4100/4200' then'1932'
        when a.cx = '石钢棒材' then'8110'
        when a.cx = '衡板冷板' then'8493'
        END company_id ,a.jhl,b.XH from
        ( SELECT cx ,"SUM"(jhl) jhl from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = #{month} AND FL_name <![CDATA[ != ]]>  '品种钢'
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx  ) a
        LEFT JOIN
        (SELECT cx ,"SUM"(jhl) xh from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = #{month} and FL_name = '现货'
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>


        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx   ) b
        on a.cx= b.CX )
        GROUP BY company_id

    </select>
    <select id="Steelmillssum" resultType="map">
        SELECT "SUM"(xh) xh,"SUM"(jh) jh from
        (
        SELECT  DECODE( COMPANY_ID,9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') companyname,"SUM"(jhl)jh,"SUM"(xh) xh FROM
        (SELECT  case
        when a.cx = '唐钢1700/1810' then'9580'
        when a.cx = '唐钢酸洗' then'9580'
        when a.cx = '唐钢一冷罩退' then'9580'
        when a.cx = '唐钢热基镀锌' then'9580'
        when a.cx = '唐钢一冷冷基镀锌' then'9580'
        when a.cx = '唐钢一冷酸轧' then'9580'
        when a.cx = '唐钢二冷酸轧' then'9580'
        when a.cx = '唐钢新区连退' then'9580'
        when a.cx = '唐钢新区镀锌' then'9580'
        when a.cx = '唐钢棒材' then'9580'
        when a.cx = '唐钢线材' then'9580'
        when a.cx = '唐钢中型' then'9580'
        when a.cx = '唐钢1580热轧线' then'9580'
        when a.cx = '唐钢中厚板' then'9580'
        when a.cx = '唐钢大型' then'9580'
        when a.cx = '唐钢中厚板' then'9580'
        when a.cx = '邯钢2250' then'7778'
        when a.cx = '邯宝酸轧' then'7778'
        when a.cx = '邯钢西区镀锌' then'7778'
        when a.cx = '邯钢西区连退' then'7778'
        when a.cx = '邯钢CSP' then'9727'
        when a.cx = '邯钢酸洗' then'9727'
        when a.cx = '邯钢一冷罩退' then'9727'
        when a.cx = '邯钢热基镀锌' then'9727'
        when a.cx = '邯钢一冷冷基镀锌' then'9727'
        when a.cx = '邯钢电镀锌' then'9727'
        when a.cx = '邯钢彩涂' then'9727'
        when a.cx = '邯钢酸轧' then'9727'
        when a.cx = '邯钢3000/3500' then'9727'
        when a.cx = '邯钢棒材' then'9727'
        when a.cx = '邯钢线材' then'9727'
        when a.cx = '邯钢新钢轧线材' then'9727'
        when a.cx = '邯钢新钢轧棒材' then'9727'
        when a.cx = '邯钢新钢轧型材' then'9727'
        when a.cx = '宣钢棒材' then'9193'
        when a.cx = '宣钢一高线、二高线' then'9193'
        when a.cx = '宣钢中型' then'9193'
        when a.cx = '宣钢带钢' then'9193'
        when a.cx = '承钢1780' then'9196'
        when a.cx = '承钢棒材' then'9196'
        when a.cx = '承钢线材' then'9196'
        when a.cx = '承钢中宽带' then'9196'
        when a.cx = '舞钢4100/4200' then'1932'
        when a.cx = '石钢棒材' then'8110'
        when a.cx = '衡板冷板' then'8493'
        END company_id ,a.jhl,b.XH from
        ( SELECT cx ,"SUM"(jhl) jhl from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = #{month} AND FL_name <![CDATA[ != ]]>  '品种钢'
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx  ) a
        LEFT JOIN
        (SELECT cx ,"SUM"(jhl) xh from
        (select *
        from (select '1' yf,year || '1月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JAN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(FEB_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(APR_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(MAY_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUN_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(JUL_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(AUG_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(SEP_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(OCT_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(NOV_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
        cx_name cx,
        fl_name,
        sum(DEC_MONTH) jhl
        from crm_resource_allocation
        where STATUS = '0'
        group by year, PZ_NAME, cx_name, fl_name) a
        WHERE  rq LIKE  #{year}||'%' and yf = #{month} and FL_name = '现货'
        <if test="name != null and name !=''">
            and a.pz=#{name}
        </if>


        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
        GROUP BY cx   ) b
        on a.cx= b.CX )
        GROUP BY company_id
        )

    </select>

    <!--四-->
    <select id="Steellist" resultType="map">

      SELECT DECODE( COMPANY_ID,9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') companyname,NVL("SUM"(JSL),0) jsl,NVL("SUM"(PZGL),0) pzgl,
				NVL("ROUND"("SUM"(PZGL)/"SUM"(JSL), 4)*100,0) bili from
(SELECT  case
        when s.cx = '唐钢1700/1810' then'9580'
        when s.cx = '唐钢酸洗' then'9580'
        when s.cx = '唐钢一冷罩退' then'9580'
        when s.cx = '唐钢热基镀锌' then'9580'
        when s.cx = '唐钢一冷冷基镀锌' then'9580'
        when s.cx = '唐钢一冷酸轧' then'9580'
        when s.cx = '唐钢二冷酸轧' then'9580'
        when s.cx = '唐钢新区连退' then'9580'
        when s.cx = '唐钢新区镀锌' then'9580'
        when s.cx = '唐钢棒材' then'9580'
        when s.cx = '唐钢线材' then'9580'
        when s.cx = '唐钢中型' then'9580'
        when s.cx = '唐钢1580热轧线' then'9580'
        when s.cx = '唐钢中厚板' then'9580'
        when s.cx = '唐钢大型' then'9580'
        when s.cx = '唐钢中厚板' then'9580'
        when s.cx = '邯钢2250' then'7778'
        when s.cx = '邯宝酸轧' then'7778'
        when s.cx = '邯钢西区镀锌' then'7778'
        when s.cx = '邯钢西区连退' then'7778'
        when s.cx = '邯钢CSP' then'9727'
        when s.cx = '邯钢酸洗' then'9727'
        when s.cx = '邯钢一冷罩退' then'9727'
        when s.cx = '邯钢热基镀锌' then'9727'
        when s.cx = '邯钢一冷冷基镀锌' then'9727'
        when s.cx = '邯钢电镀锌' then'9727'
        when s.cx = '邯钢彩涂' then'9727'
        when s.cx = '邯钢酸轧' then'9727'
        when s.cx = '邯钢3000/3500' then'9727'
        when s.cx = '邯钢棒材' then'9727'
        when s.cx = '邯钢线材' then'9727'
        when s.cx = '邯钢新钢轧线材' then'9727'
        when s.cx = '邯钢新钢轧棒材' then'9727'
        when s.cx = '邯钢新钢轧型材' then'9727'
        when s.cx = '宣钢棒材' then'9193'
        when s.cx = '宣钢一高线、二高线' then'9193'
        when s.cx = '宣钢中型' then'9193'
        when s.cx = '宣钢带钢' then'9193'
        when s.cx = '承钢1780' then'9196'
        when s.cx = '承钢棒材' then'9196'
        when s.cx = '承钢线材' then'9196'
        when s.cx = '承钢中宽带' then'9196'
        when s.cx = '舞钢4100/4200' then'1932'
        when s.cx = '石钢棒材' then'8110'
        when s.cx = '衡板冷板' then'8493'
        END company_id,s.JSL,x.PZGL from
		(SELECT cx ,"SUM"(jhl) jsl from
				(select *
				  from (select '1' yf,year || '1月'rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH) jhl
              from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '2' yf,year || '2月'rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name,fl_name
						union all
						select '3' yf,year || '3月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '4' yf,year || '4月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
							cx_name, fl_name
						union all
						select '5' yf,year || '5月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH) jhl
						  from crm_resource_allocation
							  where STATUS ='0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '6' yf,year || '6月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '7' yf,year || '7月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '8' yf,year || '8月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '9' yf,year || '9月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '10' yf,year || '10月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '11' yf,year || '11月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH) jhl
						  from crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '12' yf,year || '12月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and yf = #{month} AND FL_name  <![CDATA[ != ]]> '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
							GROUP BY cx ) s
		LEFT JOIN
		(SELECT cx ,"SUM"(jhl) pzgl from
				(select *
				  from (select '1' yf,year || '1月'rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '2' yf,year || '2月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '3' yf,year || '3月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '4' yf,year || '4月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '5' yf,year || '5月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH) jhl
						  from crm_resource_allocation
							  where STATUS ='0'
						 group by year, PZ_NAME,
							cx_name, fl_name
						union all
						select '6' yf,year || '6月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '7' yf,year || '7月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '8' yf,year || '8月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '9' yf,year || '9月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
							cx_name, fl_name
						union all
						select '10' yf,year || '10月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '11' yf,year || '11月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH) jhl
						  from crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '12' yf,year || '12月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and yf = #{month} AND FL_name = '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
							GROUP BY cx  ) x
		on s.CX= x.CX )
GROUP BY company_ID
	</select>
    <select id="Steelsum" resultType="map">
		SELECT NVL("SUM"(pzgl),0) pzgl,NVL("SUM"(jsl),0) jsl from (


      SELECT DECODE( COMPANY_ID,9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') companyname,NVL("SUM"(JSL),0) jsl,NVL("SUM"(PZGL),0) pzgl,
				NVL("ROUND"("SUM"(PZGL)/"SUM"(JSL), 4)*100,0) bili from
(SELECT  case
        when s.cx = '唐钢1700/1810' then'9580'
        when s.cx = '唐钢酸洗' then'9580'
        when s.cx = '唐钢一冷罩退' then'9580'
        when s.cx = '唐钢热基镀锌' then'9580'
        when s.cx = '唐钢一冷冷基镀锌' then'9580'
        when s.cx = '唐钢一冷酸轧' then'9580'
        when s.cx = '唐钢二冷酸轧' then'9580'
        when s.cx = '唐钢新区连退' then'9580'
        when s.cx = '唐钢新区镀锌' then'9580'
        when s.cx = '唐钢棒材' then'9580'
        when s.cx = '唐钢线材' then'9580'
        when s.cx = '唐钢中型' then'9580'
        when s.cx = '唐钢1580热轧线' then'9580'
        when s.cx = '唐钢中厚板' then'9580'
        when s.cx = '唐钢大型' then'9580'
        when s.cx = '唐钢中厚板' then'9580'
        when s.cx = '邯钢2250' then'7778'
        when s.cx = '邯宝酸轧' then'7778'
        when s.cx = '邯钢西区镀锌' then'7778'
        when s.cx = '邯钢西区连退' then'7778'
        when s.cx = '邯钢CSP' then'9727'
        when s.cx = '邯钢酸洗' then'9727'
        when s.cx = '邯钢一冷罩退' then'9727'
        when s.cx = '邯钢热基镀锌' then'9727'
        when s.cx = '邯钢一冷冷基镀锌' then'9727'
        when s.cx = '邯钢电镀锌' then'9727'
        when s.cx = '邯钢彩涂' then'9727'
        when s.cx = '邯钢酸轧' then'9727'
        when s.cx = '邯钢3000/3500' then'9727'
        when s.cx = '邯钢棒材' then'9727'
        when s.cx = '邯钢线材' then'9727'
        when s.cx = '邯钢新钢轧线材' then'9727'
        when s.cx = '邯钢新钢轧棒材' then'9727'
        when s.cx = '邯钢新钢轧型材' then'9727'
        when s.cx = '宣钢棒材' then'9193'
        when s.cx = '宣钢一高线、二高线' then'9193'
        when s.cx = '宣钢中型' then'9193'
        when s.cx = '宣钢带钢' then'9193'
        when s.cx = '承钢1780' then'9196'
        when s.cx = '承钢棒材' then'9196'
        when s.cx = '承钢线材' then'9196'
        when s.cx = '承钢中宽带' then'9196'
        when s.cx = '舞钢4100/4200' then'1932'
        when s.cx = '石钢棒材' then'8110'
        when s.cx = '衡板冷板' then'8493'
        END company_id,s.JSL,x.PZGL from
		(SELECT cx ,"SUM"(jhl) jsl from
				(select *
				  from (select '1' yf,year || '1月'rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH) jhl
              from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '2' yf,year || '2月'rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name,fl_name
						union all
						select '3' yf,year || '3月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '4' yf,year || '4月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
							cx_name, fl_name
						union all
						select '5' yf,year || '5月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH) jhl
						  from crm_resource_allocation
							  where STATUS ='0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '6' yf,year || '6月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '7' yf,year || '7月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '8' yf,year || '8月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '9' yf,year || '9月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '10' yf,year || '10月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '11' yf,year || '11月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH) jhl
						  from crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '12' yf,year || '12月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and yf = #{month} AND FL_name  <![CDATA[ != ]]> '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
							GROUP BY cx ) s
		LEFT JOIN
		(SELECT cx ,"SUM"(jhl) pzgl from
				(select *
				  from (select '1' yf,year || '1月'rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JAN_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '2' yf,year || '2月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(FEB_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '3' yf,year || '3月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAR_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '4' yf,year || '4月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(APR_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '5' yf,year || '5月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(MAY_MONTH) jhl
						  from crm_resource_allocation
							  where STATUS ='0'
						 group by year, PZ_NAME,
							cx_name, fl_name
						union all
						select '6' yf,year || '6月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUN_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '7' yf,year || '7月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(JUL_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '8' yf,year || '8月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(AUG_MONTH) jhl
						  from crm_resource_allocation
						   where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '9' yf,year || '9月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(SEP_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,
							cx_name, fl_name
						union all
						select '10' yf,year || '10月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(OCT_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name
						union all
						select '11' yf,year || '11月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(NOV_MONTH) jhl
						  from crm_resource_allocation
						  where STATUS = '0'
						 group by year, PZ_NAME,
						cx_name, fl_name
						union all
						select '12' yf,year || '12月' rq,PZ_NAME pz,
							   cx_name cx,
							   fl_name,
							   sum(DEC_MONTH) jhl
						  from crm_resource_allocation
							where STATUS = '0'
						 group by year, PZ_NAME,cx_name, fl_name) a
						WHERE  rq LIKE #{year}||'%' and yf = #{month} AND FL_name = '品种钢'

				ORDER BY    fl_name , cx ,
						"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
							GROUP BY cx  ) x
		on s.CX= x.CX )
GROUP BY company_ID

		)

	</select>


</mapper>
