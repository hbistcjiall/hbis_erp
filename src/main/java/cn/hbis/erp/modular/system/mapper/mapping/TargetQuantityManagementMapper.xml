<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hbis.erp.modular.system.mapper.TargetQuantityManagementMapper">

    <sql id="Base_Column_List">
        TQ.TARGET_QUANTITY_MANAGEMENT_ID AS ID,TQ."YEAR",AM.ACCOUNTABILITY_UNIT_NAME AS "NAME" ,JANUARY,FEBRUARY,MARCH,APRIL,MAY,JUNE,JULY,AUGUST,SEPTEMBER,OCTOBER,NOVEMBER,DECEMBER
    </sql>
    <select id="selTargetManagement" parameterType="String" resultType="map">
        select
        <include refid="Base_Column_List"/>
        from SCM_TARGET_QUANTITY_MANAGEMENT TQ
        LEFT JOIN
        SCM_ACCOUNTABILITY_UNIT_MANAGE AM
        ON
        AM.ACCOUNTABILITY_UNIT_CODE = TQ.RESPONSIBILITY_UNIT
        where TQ.DELETESTATUS = '0'
        AND AM.DELETESTATUS = '0'
        <if test="targetname != null and targetname !=''">

            and RESPONSIBILITY_UNIT like CONCAT(CONCAT('%',#{targetname}),'%')

        </if>
        <if test="year != null and year !=''">

            and YEAR like CONCAT(CONCAT('%',#{year}),'%')

        </if>
    </select>
	<select id="getlist" resultType="map">
		select sa.ACCOUNTABILITY_UNIT_CODE code,sa.ACCOUNTABILITY_UNIT_NAME NAME
		from SCM_ACCOUNTABILITY_UNIT_MANAGE  sa
		WHERE sa.DELETESTATUS = '0'
	</select>
	<select id="selectscaaccnuitList" resultType="map">
        select ACCOUNTABILITY_UNIT_ID AS ID,ACCOUNTABILITY_UNIT_CODE AS CODE,ACCOUNTABILITY_UNIT_NAME AS "NAME"
        from SCM_ACCOUNTABILITY_UNIT_MANAGE
        where DELETESTATUS = '0'
    </select>
	<select id="theList" resultType="map">
        select RESPONSIBILITY_UNIT AS CODE
        from SCM_TARGET_QUANTITY_MANAGEMENT
        where DELETESTATUS = '0' ORDER BY RESPONSIBILITY_UNIT
    </select>
	<!-- 一 -->
	<select id="salesmainsum" resultType="map">
		SELECT  "SUM"(zyfkimg) zyfkimg from
		(
		SELECT a.FL_name companyname,NVL("SUM"(JHL),0) zyfkimg from
		( select *
		from (select '1' yf,year || '1月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JAN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '2' yf,year || '2月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(FEB_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '3' yf,year || '3月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '4' yf,year || '4月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(APR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '5' yf,year || '5月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAY_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '6' yf,year || '6月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '7' yf,year || '7月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUL_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '8' yf,year || '8月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(AUG_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '9' yf,year || '9月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(SEP_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '10' yf,year || '10月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(OCT_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '11' yf,year || '11月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(NOV_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '12' yf,year || '12月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(DEC_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name) a
		WHERE rq like #{year}||'%' and yf = 3
		<if test="name != null and name !=''">
			and a.pz=#{name}
		</if>
		ORDER BY    fl_name , cx ,
		"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
		where a.FL_Name ='内贸' or  a.FL_Name ='出口' or a.FL_Name ='技术中心、事业部' or a.FL_Name ='销售总公司'

		GROUP BY a.FL_NAME

		)

	</select>
	<select id="salesmain" resultType="map">
		SELECT a.FL_name companyname,NVL("SUM"(JHL),0) zyfkimg from
		( select *
		from (select '1' yf,year || '1月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JAN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '2' yf,year || '2月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(FEB_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '3' yf,year || '3月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '4' yf,year || '4月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(APR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '5' yf,year || '5月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAY_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '6' yf,year || '6月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '7' yf,year || '7月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUL_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '8' yf,year || '8月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(AUG_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '9' yf,year || '9月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(SEP_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '10' yf,year || '10月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(OCT_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '11' yf,year || '11月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(NOV_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '12' yf,year || '12月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(DEC_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name) a
		WHERE rq LIKE #{year}||'%' and
		yf = 3
		<if test="name != null and name !=''">
			and a.pz=#{name}
		</if>
		ORDER BY    fl_name , cx ,
		"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
		where a.FL_Name ='内贸' or  a.FL_Name ='出口' or a.FL_Name ='技术中心、事业部' or a.FL_Name ='销售总公司'

		GROUP BY a.FL_NAME

	</select>
	<!-- 二 -->
	<select id="Steelmillsplan" resultType="map">
		SELECT  distinct "DECODE"(n.COMPANY_ID,9580,
		'唐钢',
		9727,
		'邯钢',
		9193,
		'宣钢',
		9196,
		'承钢',
		1932,
		'舞钢',
		8110,
		'石钢',
		8493,
		'衡板',
		7778,
		'邯宝' ) companyname,"SUM"(m.xh) xh,"SUM"(m.jhl) jh from
		( SELECT z.CX,x.XH,z.jhl from
		(SELECT "SUM"(JHL) xh,cx from
		( select *
		from (select '1' yf,year || '1月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JAN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '2' yf,year || '2月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(FEB_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '3' yf,year || '3月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '4' yf,year || '4月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(APR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '5' yf,year || '5月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAY_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '6' yf,year || '6月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '7' yf,year || '7月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUL_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '8' yf,year || '8月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(AUG_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '9' yf,year || '9月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(SEP_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '10' yf,year || '10月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(OCT_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '11' yf,year || '11月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(NOV_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '12' yf,year || '12月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(DEC_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name) a
		where rq like #{year}||'%' and yf = 3 and FL_name = '现货'
		<if test="name != null and name !=''">
			and a.pz=#{name}
		</if>
		ORDER BY    fl_name , cx ,
		"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材'))
		GROUP BY cx ) x
		LEFT JOIN
		(SELECT "SUM"(JHL) jhl,cx from
		( select *
		from (select '1' yf,year || '1月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JAN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '2' yf,year || '2月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(FEB_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '3' yf,year || '3月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '4' yf,year || '4月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(APR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '5' yf,year || '5月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAY_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '6' yf,year || '6月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '7' yf,year || '7月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUL_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '8' yf,year || '8月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(AUG_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '9' yf,year || '9月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(SEP_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '10' yf,year || '10月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(OCT_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '11' yf,year || '11月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(NOV_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '12' yf,year || '12月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(DEC_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name) a
		where rq like #{year}||'%' and yf = 3
		<if test="name != null and name !=''">
			and a.pz=#{name}
		</if>
		ORDER BY    fl_name , cx ,
		"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材'))
		GROUP BY cx ) z
		on z.Cx =x.CX  ) m

		LEFT JOIN
		(SELECT COMPANY_ID,cx_name from

		(SELECT a.*,GP.COMPANY_ID from (
		SELECT CRA.CX_NAME , CRA.PZ_NAME
		from CRM_RESOURCE_ALLOCATION cra
		GROUP BY cra.CX_NAME, CRA.PZ_NAME) a
		LEFT JOIN SCM_VARIETY_TO_PT_GP gp
		on gp.variety = a.PZ_name ) ) n
		on n.CX_NAME = m.cx
		GROUP BY n.COMPANY_ID
		ORDER BY "DECODE"(n.COMPANY_ID,9580,
		'唐钢',
		9727,
		'邯钢',
		9193,
		'宣钢',
		9196,
		'承钢',
		1932,
		'舞钢',
		8110,
		'石钢',
		8493,
		'衡板',
		7778,
		'邯宝' )

	</select>
	<select id="Steelmillssum" resultType="map">
		SELECT "SUM"(xh) xh,"SUM"(jh) jh from
		(
		SELECT  distinct "DECODE"(n.COMPANY_ID,9580,
		'唐钢',
		9727,
		'邯钢',
		9193,
		'宣钢',
		9196,
		'承钢',
		1932,
		'舞钢',
		8110,
		'石钢',
		8493,
		'衡板',
		7778,
		'邯宝' ) companyname,"SUM"(m.xh) xh,"SUM"(m.jhl) jh from
		( SELECT z.CX,x.XH,z.jhl from
		(SELECT "SUM"(JHL) xh,cx from
		( select *
		from (select '1' yf,year || '1月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JAN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '2' yf,year || '2月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(FEB_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '3' yf,year || '3月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '4' yf,year || '4月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(APR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '5' yf,year || '5月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAY_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '6' yf,year || '6月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '7' yf,year || '7月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUL_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '8' yf,year || '8月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(AUG_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '9' yf,year || '9月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(SEP_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '10' yf,year || '10月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(OCT_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '11' yf,year || '11月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(NOV_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '12' yf,year || '12月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(DEC_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name) a
		where rq like #{year}||'%' and yf = 3 and FL_name = '现货'
		<if test="name != null and name !=''">
			and a.pz=#{name}
		</if>
		ORDER BY    fl_name , cx ,
		"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材'))
		GROUP BY cx ) x
		LEFT JOIN
		(SELECT "SUM"(JHL) jhl,cx from
		( select *
		from (select '1' yf,year || '1月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JAN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '2' yf,year || '2月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(FEB_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '3' yf,year || '3月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '4' yf,year || '4月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(APR_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '5' yf,year || '5月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(MAY_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '6' yf,year || '6月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUN_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '7' yf,year || '7月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(JUL_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '8' yf,year || '8月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(AUG_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '9' yf,year || '9月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(SEP_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '10' yf,year || '10月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(OCT_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '11' yf,year || '11月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(NOV_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name
		union all
		select '12' yf,year || '12月' rq,PZ_NAME pz,
		cx_name cx,
		fl_name,
		sum(DEC_MONTH) jhl
		from crm_resource_allocation
		where STATUS = '0'
		group by year, PZ_NAME, cx_name, fl_name) a
		where rq like #{year}||'%' and yf = 3
		<if test="name != null and name !=''">
			and a.pz=#{name}
		</if>
		ORDER BY    fl_name , cx ,
		"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材'))
		GROUP BY cx ) z
		on z.Cx =x.CX  ) m

		LEFT JOIN
		(SELECT COMPANY_ID,cx_name from

		(SELECT a.*,GP.COMPANY_ID from (
		SELECT CRA.CX_NAME , CRA.PZ_NAME
		from CRM_RESOURCE_ALLOCATION cra
		GROUP BY cra.CX_NAME, CRA.PZ_NAME) a
		LEFT JOIN SCM_VARIETY_TO_PT_GP gp
		on gp.variety = a.PZ_name ) ) n
		on n.CX_NAME = m.cx
		GROUP BY n.COMPANY_ID
		ORDER BY "DECODE"(n.COMPANY_ID,9580,
		'唐钢',
		9727,
		'邯钢',
		9193,
		'宣钢',
		9196,
		'承钢',
		1932,
		'舞钢',
		8110,
		'石钢',
		8493,
		'衡板',
		7778,
		'邯宝' )
		)

	</select>



	<!--三-->
	<select id="typeselect" resultType="map">
		SELECT a.pz ,a.pzgl ,b.jsl ,"ROUND"(a.pzgl/b.jsl, 2)*100|| '%'  bili  from
(SELECT Pz, "SUM"(jhl) pzgl from
(select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3 AND FL_name ='品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
GROUP BY pz ) a
LEFT JOIN (
SELECT Pz, "SUM"(jhl) jsl from
(
select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3 AND FL_name!= '品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
		)
		GROUP BY pz ) b
		on a.pz = b.pz


	</select>
	<select id="typessum" resultType="map">
		SELECT sum(pzgl) pzgl,"SUM"(jsl) jsl, "ROUND"((sum(pzgl)/"SUM"(jsl))*100, 2)|| '%'  bili
		from
		(
		SELECT a.pz ,a.pzgl ,b.jsl ,"ROUND"(a.pzgl/b.jsl, 2)*100  bili  from
(SELECT Pz, "SUM"(jhl) pzgl from
(select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3 AND FL_name ='品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
GROUP BY pz ) a
LEFT JOIN (
SELECT Pz, "SUM"(jhl) jsl from
(
select *
  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JAN_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '2' yf,year || '2月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(FEB_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '3' yf,year || '3月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAR_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '4' yf,year || '4月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(APR_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '5' yf,year || '5月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(MAY_MONTH) jhl
          from crm_resource_allocation
              where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '6' yf,year || '6月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUN_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '7' yf,year || '7月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(JUL_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '8' yf,year || '8月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(AUG_MONTH) jhl
          from crm_resource_allocation
           where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '9' yf,year || '9月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(SEP_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '10' yf,year || '10月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(OCT_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '11' yf,year || '11月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(NOV_MONTH) jhl
          from crm_resource_allocation
          where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name
        union all
        select '12' yf,year || '12月' rq,PZ_NAME pz,
               cx_name cx,
               fl_name,
               sum(DEC_MONTH) jhl
          from crm_resource_allocation
            where STATUS = '0'
         group by year, PZ_NAME, cx_name, fl_name) a
					where rq LIKE #{year}||'%' AND yf = 3 AND FL_name!= '品种钢'
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
		)
		GROUP BY pz ) b
		on a.pz = b.pz

		)

	</select>



	<!--四-->
	<select id="Steellist" resultType="map">
					SELECT "DECODE"(n.COMPANY_ID,9580,
			'唐钢',
			9727,
			'邯钢',
			9193,
			'宣钢',
			9196,
			'承钢',
			1932,
			'舞钢',
			8110,
			'石钢',
			8493,
			'衡板',
			7778,
			'邯宝' ) companyname,
	NVL("SUM"(p.pzgl),0) pzgl,NVL("SUM"(jsl),0) jsl ,

		NVL("ROUND"("SUM"(p.pzgl)/"SUM"(jsl)*100, 2),0)|| '%'   bili  from
	 (SELECT m.cx,m.pzgl,n.jhl jsl from
	 (SELECT cx,"SUM"(jhl) pzgl from
	(select *
	  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JAN_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '2' yf,year || '2月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(FEB_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '3' yf,year || '3月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAR_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '4' yf,year || '4月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(APR_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '5' yf,year || '5月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAY_MONTH) jhl
			  from crm_resource_allocation
				  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '6' yf,year || '6月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUN_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '7' yf,year || '7月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUL_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '8' yf,year || '8月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(AUG_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '9' yf,year || '9月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(SEP_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '10' yf,year || '10月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(OCT_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '11' yf,year || '11月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(NOV_MONTH) jhl
			  from crm_resource_allocation
			  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '12' yf,year || '12月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(DEC_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name) a
			WHERE   rq LIKE #{year}||'%' and yf = 3 AND FL_name = '品种钢'
	ORDER BY    fl_name , cx ,
			"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
	 GROUP BY cx)  m
	LEFT JOIN
	(SELECT cx ,"SUM"(jhl) jhl from
	(select *
	  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JAN_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '2' yf,year || '2月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(FEB_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '3' yf,year || '3月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAR_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '4' yf,year || '4月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(APR_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '5' yf,year || '5月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAY_MONTH) jhl
			  from crm_resource_allocation
				  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '6' yf,year || '6月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUN_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '7' yf,year || '7月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUL_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '8' yf,year || '8月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(AUG_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '9' yf,year || '9月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(SEP_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '10' yf,year || '10月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(OCT_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '11' yf,year || '11月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(NOV_MONTH) jhl
			  from crm_resource_allocation
			  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '12' yf,year || '12月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(DEC_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name) a
			WHERE  rq LIKE #{year}||'%' and yf = 3 AND FL_name != '品种钢'

	ORDER BY    fl_name , cx ,
			"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
				GROUP BY cx) n
	on n.cx=m.cx ) p

	LEFT JOIN
	(SELECT COMPANY_ID,cx_name from

	(SELECT a.*,GP.COMPANY_ID from (
	SELECT CRA.CX_NAME , CRA.PZ_NAME
	from CRM_RESOURCE_ALLOCATION cra
	GROUP BY cra.CX_NAME, CRA.PZ_NAME) a
	LEFT JOIN SCM_VARIETY_TO_PT_GP gp
			on gp.variety = a.PZ_name ) ) n
	on n.CX_NAME = p.cx
	GROUP BY n.COMPANY_ID
	</select>
	<select id="Steelsum" resultType="map">
		SELECT NVL("SUM"(pzgl),0) pzgl,NVL("SUM"(jsl),0) jsl from (
			SELECT "DECODE"(n.COMPANY_ID,9580,
			'唐钢',
			9727,
			'邯钢',
			9193,
			'宣钢',
			9196,
			'承钢',
			1932,
			'舞钢',
			8110,
			'石钢',
			8493,
			'衡板',
			7778,
			'邯宝' ) companyname,
	NVL("SUM"(p.pzgl),0) pzgl,NVL("SUM"(jsl),0) jsl ,

		NVL("ROUND"("SUM"(p.pzgl)/"SUM"(jsl)*100, 2),0)|| '%'   bili  from
	 (SELECT m.cx,m.pzgl,n.jhl jsl from
	 (SELECT cx,"SUM"(jhl) pzgl from
	(select *
	  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JAN_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '2' yf,year || '2月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(FEB_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '3' yf,year || '3月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAR_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '4' yf,year || '4月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(APR_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '5' yf,year || '5月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAY_MONTH) jhl
			  from crm_resource_allocation
				  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '6' yf,year || '6月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUN_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '7' yf,year || '7月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUL_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '8' yf,year || '8月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(AUG_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '9' yf,year || '9月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(SEP_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '10' yf,year || '10月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(OCT_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '11' yf,year || '11月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(NOV_MONTH) jhl
			  from crm_resource_allocation
			  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '12' yf,year || '12月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(DEC_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name) a
			WHERE   rq LIKE #{year}||'%' and yf = 3 AND FL_name = '品种钢'
	ORDER BY    fl_name , cx ,
			"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') )
	 GROUP BY cx)  m
	LEFT JOIN
	(SELECT cx ,"SUM"(jhl) jhl from
	(select *
	  from (select '1' yf,year || '1月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JAN_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '2' yf,year || '2月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(FEB_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '3' yf,year || '3月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAR_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '4' yf,year || '4月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(APR_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '5' yf,year || '5月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(MAY_MONTH) jhl
			  from crm_resource_allocation
				  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '6' yf,year || '6月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUN_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '7' yf,year || '7月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(JUL_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '8' yf,year || '8月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(AUG_MONTH) jhl
			  from crm_resource_allocation
			   where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '9' yf,year || '9月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(SEP_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '10' yf,year || '10月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(OCT_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '11' yf,year || '11月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(NOV_MONTH) jhl
			  from crm_resource_allocation
			  where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name
			union all
			select '12' yf,year || '12月' rq,PZ_NAME pz,
				   cx_name cx,
				   fl_name,
				   sum(DEC_MONTH) jhl
			  from crm_resource_allocation
				where STATUS = '0'
			 group by year, PZ_NAME, cx_name, fl_name) a
			WHERE  rq LIKE #{year}||'%' and yf = 3 AND FL_name != '品种钢'

	ORDER BY    fl_name , cx ,
			"DECODE"(pz,'热板','冷板','宽厚板','棒线','型材') ) a
				GROUP BY cx) n
	on n.cx=m.cx ) p

	LEFT JOIN
	(SELECT COMPANY_ID,cx_name from

	(SELECT a.*,GP.COMPANY_ID from (
	SELECT CRA.CX_NAME , CRA.PZ_NAME
	from CRM_RESOURCE_ALLOCATION cra
	GROUP BY cra.CX_NAME, CRA.PZ_NAME) a
	LEFT JOIN SCM_VARIETY_TO_PT_GP gp
			on gp.variety = a.PZ_name ) ) n
	on n.CX_NAME = p.cx
	GROUP BY n.COMPANY_ID
		)

	</select>






</mapper>
