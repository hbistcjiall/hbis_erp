<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper">

    <select id="getcx" resultType="map">
        select COMPANYNAME, NAME,NVL(FKIMG,0) FKIMG,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,NVL(ZYFKIMG,0) ZYFKIMG,NVL(ZYPZGL,0) ZYPZGL,NVL(FGSFKIMG,0) FGSFKIMG,NVL(FGSPZGL,0) FGSPZGL,NVL(ZGSFKIMG,0) ZGSFKIMG,NVL(ZGSPZGL,0) ZGSPZGL, SYPZB,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ from (select
        COMPANYNAME, NAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB,BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT

        <if test="zt==0">
            COMPANYNAME,
            NAME,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
            sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
            sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
            sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
            sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
            sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '专业公司' then fkimg end) zybz,
            sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '分公司' then fkimg end) fgsbz,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) bz,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) sypzb
        </if>

        <if test="zt==1">
            COMPANYNAME,
            NAME,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
            sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
            sum(case when sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
            sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
            sum(case when sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
            sum(case when sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '专业公司' then fkimg end) zybz,
            sum(case when sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '分公司' then fkimg end) fgsbz,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) bz,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) sypzb
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname,t.name) a
        union all (
        select
        COMPANYNAME, NAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT

        <if test="zt==0">
            COMPANYNAME,
            NAME,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
            sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
            sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
            sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
            sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
            sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '专业公司' then fkimg end) zybz,
            sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '分公司' then fkimg end) fgsbz,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) bz,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) sypzb
        </if>

        <if test="zt==1">
            COMPANYNAME,
            NAME,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
            sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
            sum(case when sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
            sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
            sum(case when sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
            sum(case when sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '专业公司' then fkimg end) zybz,
            sum(case when sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '分公司' then fkimg end) fgsbz,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) bz,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg) sypzb
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname,t.name) a
        )
        union all
        ( select companyname,name,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        decode(fgsfkimg,0,0,fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select

        <if test="zt==0">
            companyname,name,
            sum(case when company_id='8110' then
            (case when (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end)
            WHEN company_id='1932' then
            (case when sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end) end )
            zyfkimg,
            sum(case when company_id='8110' then
            case when (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else
            case when sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end end)
            zypzgl,
            0
            fgsfkimg,
            0
            fgspzgl,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部')  then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
            zgsfkimg,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
            zgspzgl,
            sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg)
            sypzb
        </if>

        <if test="zt==1">
            companyname,name,
            sum(case when company_id='8110' then
            (case when (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end)
            WHEN company_id='1932' then
            (case when sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end) end )
            zyfkimg,
            sum(case when company_id='8110' then
            case when (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else
            case when sale_group = '销售部' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end end)
            zypzgl,
            0
            fgsfkimg,
            0
            fgspzgl,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部')  then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
            zgsfkimg,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
            zgspzgl,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(fkimg)
            sypzb
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by  t.companyname,t.name  )
        ) ) where 1=1
        and  NAME &lt; &gt; '唐钢1580热轧线'  and  name &lt; &gt; '唐钢中厚板'
        <if test="dw != '' and  dw != null and  dw != 'undefined' and dw !='全部'">
            and COMPANYNAME = #{dw}
        </if>
        <if test="cx != null and  cx.size > 0">
            and   NAME in
            <foreach item="item" index="index" collection="cx" open="(" separator="," close=")">
                　　#{item}
            </foreach>
        </if>
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板'，'7')



    </select>

    <select id="getpz" resultType="map">
        select name,NVL(sum(FKIMG),0) FKIMG,NVL(sum(pzgl),0) pzgl,sum(pzgl)/sum(FKIMG) bz,NVL(sum(zyfkimg),0) zyfkimg,NVL(sum(zypzgl),0) zypzgl,sum(zypzgl)/sum(zyfkimg) zybz,NVL(sum(fgsfkimg),0) fgsfkimg,NVL(sum(fgspzgl),0) fgspzgl,decode(sum(fgsfkimg),0,0,sum(fgspzgl)/sum(fgsfkimg)) fgsbz,NVL(sum(zgsfkimg),0) zgsfkimg,NVL(sum(zgspzgl),0) zgspzgl,sum(zgspzgl)/sum(zgsfkimg) zgsbz from
        (select NAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from （SELECT

        <if test="zt==0">
            NAME,
            sum(case when   sale_body = '专业公司' then fkimg end)
            zyfkimg,
            sum(case when   sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum(case when   sale_body = '分公司' then fkimg end)
            fgsfkimg,
            sum(case when   sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            fgspzgl,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
            zgsfkimg,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zgspzgl
        </if>

        <if test="zt==1">
            NAME,
            sum(case when   sale_body = '专业公司' then fkimg end)
            zyfkimg,
            sum(case when   sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum(case when   sale_body = '分公司' then fkimg end)
            fgsfkimg,
            sum(case when   sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            fgspzgl,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
            zgsfkimg,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zgspzgl
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) a



        union all

        (
        select NAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from （SELECT

        <if test="zt==0">
            NAME,
            sum(case when   sale_body = '专业公司' then fkimg end)
            zyfkimg,
            sum(case when   sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum(case when   sale_body = '分公司' then fkimg end)
            fgsfkimg,
            sum(case when   sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            fgspzgl,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
            zgsfkimg,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zgspzgl
        </if>

        <if test="zt==1">
            NAME,
            sum(case when   sale_body = '专业公司' then fkimg end)
            zyfkimg,
            sum(case when   sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum(case when   sale_body = '分公司' then fkimg end)
            fgsfkimg,
            sum(case when   sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            fgspzgl,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
            zgsfkimg,
            sum(case when   (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zgspzgl
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) )


        union all

        ( select name,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl
        from(select

        <if test="zt==0">
            name,
            sum(case when company_id='8110' then
            (case when (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end)
            WHEN company_id='1932' then
            (case when sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end) end )
            zyfkimg,
            sum(case when company_id='8110' then
            case when (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else
            case when sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end end)
            zypzgl,
            0
            fgsfkimg,
            0
            fgspzgl,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部')  then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
            zgsfkimg,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
            zgspzgl
        </if>

        <if test="zt==1">
            name,
            sum(case when company_id='8110' then
            (case when (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end)
            WHEN company_id='1932' then
            (case when sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end) end )
            zyfkimg,
            sum(case when company_id='8110' then
            case when (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else
            case when sale_group = '销售部' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end end)
            zypzgl,
            0
            fgsfkimg,
            0
            fgspzgl,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部')  then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
            zgsfkimg,
            sum(case when company_id = '1932'  then
            case when (sale_group = '科技部') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
            when company_id ='8493'  then
            case when (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
            zgspzgl
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by t.name  ))

        )
        <if test="pz != '' and  pz!= null and  pz != 'undefined'">
            where name = #{pz}
        </if>
        group by name       order by "DECODE"(name,'热板','1','冷板','2','宽厚板','3','棒线','4','型带','5','特钢','6','薄板'，'7')

    </select>

    <select id="getzrbm" resultType="map">
select companyname,"DECODE"(companyname,'热板公司','1','冷板公司','2','宽厚板公司','3','棒线公司','4','型带公司','5','特钢公司','6','薄板公司'，'7','唐钢分公司','8','邯钢分公司','9','宣钢分公司','10','承钢分公司','11','舞钢分公司','12','石钢分公司','13','衡板分公司'，'14'),
NVL(fkimg,0) fkimg,bz,NVL(pzgl,0) pzgl,mbl,wcbl from (select companyname,fkimg,bz,pzgl,mbl,pzgl/mbl wcbl from(select COMPANYNAME||'分公司' COMPANYNAME ,FKIMG,PZGL,bz from (select COMPANYNAME,   FKIMG,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  BZ from (select
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT

        <if test="zt==0">
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat  &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        </if>

        <if test="zt==1">
        COMPANYNAME,
        sum(case when  product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
        sum(case when  product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat  &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
    </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT

        <if test="zt==0">
        COMPANYNAME,
        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat  &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        </if>

        <if test="zt==1">
            COMPANYNAME,
            sum(case when product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
            sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
            sum(case when sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
            sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
            sum(case when sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
            sum(case when sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '专业公司' then fkimg end) zybz,
            sum(case when sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when sale_body = '分公司' then fkimg end) fgsbz,
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
            sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
            (sum(case when fkdat  &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select

        <if test="zt==0">
        companyname,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat  &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat  &gt;= to_date ('2019-02-01','yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat  &gt;= to_date ('2019-02-01','yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        </if>

        <if test="zt==1">
            companyname,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
            zyfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum( case when company_id='8110' then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end else null end )
            fgsfkimg,
            sum( case when company_id='8110' then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
            fgspzgl,
            sum(case when company_id = '1932'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
            when company_id ='8493'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
            zgsfkimg,
            sum(case when company_id = '1932'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
            when company_id ='8493'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
            zgspzgl,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end)
            sypzb,
            (sum(case when fkdat  &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat  &gt;= to_date ('2019-02-01','yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
            sum(case when fkdat  &gt;= to_date ('2019-02-01','yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
            hb
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME &lt; &gt; '唐钢1580热轧线'  and  t.name &lt; &gt; '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板'，'7'))

        union  (
        select name||'公司' COMPANYNAME,sum(FKIMG) FKIMG,sum(pzgl) pzgl,sum(pzgl)/sum(FKIMG) bz from
(select NAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from （SELECT

        <if test="zt==0">
        NAME,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        fgspzgl,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
        zgsfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zgspzgl
        </if>

        <if test="zt==1">
            NAME,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
            zyfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
            fgsfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            fgspzgl,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
            zgsfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zgspzgl
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) a
       union all
       (
        select NAME COMPANYNAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from （SELECT

        <if test="zt==0">
        NAME,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        fgspzgl,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
         zgsfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
         zgspzgl
        </if>

        <if test="zt==1">
            NAME,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
            zyfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
            fgsfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            fgspzgl,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
            zgsfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zgspzgl
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt; &gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt; &gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt; &gt; '出口'  and
        xsztdzb.sale_body_des &lt; &gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) )


        union all

       ( select name,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl
        from(select

        <if test="zt==0">
        name,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl
        </if>

        <if test="zt==1">
            name,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
            zyfkimg,
            sum(case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
            zypzgl,
            sum( case when company_id='8110' then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口')  then fkimg end else null end )
            fgsfkimg,
            sum( case when company_id='8110' then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt; &gt; '出口') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
            fgspzgl,
            sum(case when company_id = '1932'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
            when company_id ='8493'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
            zgsfkimg,
            sum(case when company_id = '1932'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
            when company_id ='8493'  then
            case when fkdat  &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
            zgspzgl
        </if>

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
         (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt; &gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat &gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id))  &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by t.name  ))

        )  group by name
        )
        ) c

           left join
        (select
        SAU.ACCOUNTABILITY_UNIT_NAME zrbm,
        JANUARY +
        FEBRUARY +
        MARCH +
        APRIL +
        MAY +
        JUNE +
        JULY +
        AUGUST +
        SEPTEMBER +
        OCTOBER +
        NOVEMBER +
        DECEMBER mbl
        from SCM_ACCOUNTABILITY_UNIT_MANAGE SAU
        LEFT JOIN SCM_TARGET_QUANTITY_MANAGEMENT SQM
        on SAU.ACCOUNTABILITY_UNIT_CODE = SQM.RESPONSIBILITY_UNIT
        where SQM.DELETESTATUS='0' order by zrbm ) mb
        on mb.zrbm = c.companyName
        )
        <if test="zrbm != '' and  zrbm!= null and  zrbm != 'undefined'">
            where companyname=#{zrbm}
        </if>

         order by "DECODE"(companyname,'热板公司',1,'冷板公司',2,'宽厚板公司',3,'棒线公司',4,'型带公司',5,'特钢公司',6,'薄板公司'，7,'唐钢分公司',8,'邯钢分公司',9,'宣钢分公司',10,'承钢分公司',11,'舞钢分公司',12,'石钢分公司',13,'衡板分公司'，14)







    </select>

    <select id="getjszl" resultType="map">
        SELECT decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        round(SUM(settle.fkimg),2),
        SUM(KZWI6) AS jsjg,
        round(SUM(KZWI6)/SUM(settle.fkimg),2) jsjj
        FROM scm_steel_settle settle
        left JOIN scm_delivery_detail detail
        ON settle.aubel = detail.order_no
        AND settle.aupos = detail.order_item
        JOIN scm_sale_order sso
        ON sso.order_no = settle.aubel
        AND sso.company_id = settle.company_id
        GROUP BY settle.company_id
        ORDER BY company_id
    </select>

    <select id="getpzjszl" resultType="map">
       select name VARIETY,round(sum(FKIMG),2) jsl,round(sum(kzwi6),2) jsjg,round(NVL(sum(kzwi6)/sum(FKIMG),0),2) jsjj from
(
select NAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zykzwi6,0)+NVL(fgskzwi6,0)+NVL(zgskzwi6,0)) kzwi6,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from (SELECT

        NAME,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then kzwi6 end)
        zykzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then kzwi6 end)
        fgskzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        fgspzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部' or sale_body='子公司' or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
        zgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部' or sale_body='子公司' or sale_body  = '现货' or sale_body='自办公司')   then kzwi6 end)
        zgskzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zgspzgl
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt;&gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt;&gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt;&gt; '出口'  and
        xsztdzb.sale_body_des &lt;&gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) a
       union all
       (
        select NAME COMPANYNAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zykzwi6,0)+NVL(fgskzwi6,0)+NVL(zgskzwi6,0)) kzwi6,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from (SELECT

        NAME,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then kzwi6 end)
        zykzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then kzwi6 end)
        fgskzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        fgspzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
         zgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then kzwi6 end)
         zgskzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
         zgspzgl
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt;&gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt;&gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt;&gt; '出口'  and
        xsztdzb.sale_body_des &lt;&gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) )


        union all

       ( select name,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,(NVL(zykzwi6,0)+NVL(fgskzwi6,0)+NVL(zgskzwi6,0)) kzwi6,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl
        from(select  name,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when kzwi6 is null then '0' else kzwi6 end end)
        zykzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口')  then fkimg end else null end )
        fgsfkimg,
				sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口')  then kzwi6 end else null end )
        fgskzwi6,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
				sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then kzwi6 end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then kzwi6 end end)
        zgskzwi6,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
         (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by t.name  ))

        )  group by name
    </select>

    <select id="getpzgjswc" resultType="map">
      select name ,sum(FKIMG) jsl,sum(pzgl) pzgl,NVL(sum(pzgl)/sum(FKIMG),0) wcl from
(select NAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from (SELECT

        NAME,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        fgspzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部' or sale_body='子公司' or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
        zgsfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部' or sale_body='子公司' or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zgspzgl
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt;&gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt;&gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt;&gt; '出口'  and
        xsztdzb.sale_body_des &lt;&gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) a
       union all
       (
        select NAME COMPANYNAME, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl from (SELECT

        NAME,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        fgspzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
         zgsfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
         zgspzgl




        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt;&gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt;&gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt;&gt; '出口'  and
        xsztdzb.sale_body_des &lt;&gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) )


        union all

       ( select name,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,(NVL(zypzgl,0)+NVL(fgspzgl,0)+NVL(zgspzgl,0)) pzgl,zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl
        from(select  name,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
         (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by t.name  ))

        )  group by name
   </select>

    <select id="getzgsjswc" resultType="map">
   select COMPANYNAME name,   FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (select
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部' or sale_body='子公司'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部' or sale_body='子公司' or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt;&gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt;&gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt;&gt; '出口'  and
        xsztdzb.sale_body_des &lt;&gt; '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')  and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsbz,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  &lt;&gt;'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  &lt;&gt;'唐钢不锈钢公司' and
        xsztdzb.sale_body_des &lt;&gt; '出口'  and
        xsztdzb.sale_body_des &lt;&gt; '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body &lt;&gt; '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt; = to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat &gt; = to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME &lt;&gt; '唐钢1580热轧线'  and  t.name &lt;&gt; '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板'，'7')
</select>

    <select id="getzyjh" resultType="map">
    select *
    from (select '1' yf,year || '1月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(JAN_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '2' yf,year || '2月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(FEB_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '3' yf,year || '3月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(MAR_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '4' yf,year || '4月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(APR_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '5' yf,year || '5月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(MAY_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '6' yf,year || '6月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(JUN_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '7' yf,year || '7月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(JUL_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '8' yf,year || '8月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(AUG_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '9' yf,year || '9月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(SEP_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '10' yf,year || '10月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(OCT_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '11' yf,year || '11月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(NOV_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name
    union all
    select '12' yf,year || '12月' rq,PZ_NAME pz,
    cx_name cx,
    fl_name,
    sum(DEC_MONTH) jhl
    from crm_resource_allocation
    where STATUS = '0'
    group by year, PZ_NAME, cx_name, fl_name) a

    where
    rq like  '%'||#{nf}||'%'
    <if test="yf != ''">
        and yf = #{yf}
    </if>
    <if test="pz != '' and pz != null and pz !='全部' ">
        and pz = #{pz}
    </if>
        <if test="cx != null and  cx.size > 0">
            and   cx in
            <foreach item="item" index="index" collection="cx" open="(" separator="," close=")">
                　　#{item}
            </foreach>
        </if>
        <if test="xszt != ''and xszt != null and xszt != 'undefined' and xszt != '全部'">
        and fl_name = #{xszt}
        </if>
        ORDER BY    fl_name , cx ,
        "DECODE"(pz,'热板','冷板','宽厚板','棒线','型材')
    </select>

    <select id="getzyjhcxtjpz" resultType="map">
        select distinct pz_name pz
        from crm_resource_allocation pz_name
    </select>

    <select id="getzyjhcxtjcx" resultType="map">
        select distinct cx_name cx
        from crm_resource_allocation
        <if test="pz != '' and pz != null and pz !='全部'">
            where pz_name = #{pz}
        </if>
        order by cx_name
    </select>

    <select id="getzyjhcxtjxszt" resultType="map">
        select distinct fl_name xszt
        from crm_resource_allocation pz_name
    </select>

    <select id="getpzhtjd" resultType="map">
        select pzName,
        case
        when hjhtl is null then
        0
        else
        hjhtl
        end hjhtl,
        case
        when hjjhl is null then
        0
        else
        hjjhl
        end hjjhl,
        case
        when hjjhl = 0 then
        0
        when hjhtl / hjjhl is null then
        0
        else
        ROUND(hjhtl / hjjhl * 100, 2)
        END AS schedulehj,
        case
        when zygshtl is null then
        0
        else
        zygshtl
        end zygshtl,
        case
        when zyfgshtl is null then
        0
        else
        zyfgshtl
        end zyfgshtl,
        case
        when planNumxsz is null then
        0
        else
        planNumxsz
        end planNumxsz,
        case
        when planNumxsz = 0 then
        0
        when htlzgs / planNumxsz is null then
        0
        else
        ROUND(htlzgs / planNumxsz * 100, 2)
        END AS schedulexsz,
        case
        when htlzgs = 0 or htlzgs is null then
        nvl(-planNumxsz, 0)
        when planNumxsz = 0 or planNumxsz is null then
        htlzgs
        else
        htlzgs - planNumxsz
        end jdxsz,
        case
        when zgshtl is null then
        0
        else
        zgshtl
        end zgshtl,
        case
        when planNumzgs is null then
        0
        else
        planNumzgs
        end planNumzgs,
        case
        when planNumzgs = 0 then
        0
        when zgshtl / planNumzgs is null then
        0
        else
        ROUND(zgshtl / planNumzgs * 100, 2)
        END AS schedulezgs,
        case
        when zgshtl = 0 or zgshtl is null then
        nvl(-planNumzgs, 0)
        when planNumzgs = 0 or planNumzgs is null then
        zgshtl
        else
        zgshtl - planNumzgs
        end jdzgs,
        case
        when ckhtl is null then
        0
        else
        ckhtl
        end ckhtl,
        case
        when planNumck is null then
        0
        else
        planNumck
        end planNumck,
        case
        when planNumck = 0 then
        0
        when ckhtl / planNumck is null then
        0
        else
        ROUND(ckhtl / planNumck * 100, 2)
        END AS scheduleck,
        case
        when ckhtl = 0 or ckhtl is null then
        nvl(-planNumck, 0)
        when planNumck = 0 or planNumck is null then
        ckhtl
        else
        ckhtl - planNumck
        end jdck
        from (select distinct ht.pzName pzName,
        sum(ht.orderMount) hjhtl,
        hjjhl,
        sum(case
        when ht.saleBody = '专业公司' or ht.saleBody = '分公司' or
        (ht.companyId = '1932' or ht.saleGroup = '销售部') or
        (ht.companyId = '8110' and ht.ssaleBody = '分公司' and
        ht.ssaleBody <![CDATA[ != ]]> '出口') then
        ht.orderMount
        end) htlzgs,
        sum(case
        when ht.saleBody = '专业公司' or
        (ht.companyId = '1932' or ht.saleGroup = '销售部') or
        (ht.companyId = '8110' and ht.ssaleBody = '分公司' and
        ht.ssaleBody <![CDATA[ != ]]> '出口') then
        ht.orderMount
        end) zygshtl,
        sum(case
        when ht.saleBody = '分公司' then
        ht.orderMount
        end) zyfgshtl,
        sum(case
        when ht.saleBody = '技术中心' or ht.saleBody = '事业部' or
        ht.saleBody = '子公司' or ht.saleBody = '自办公司' or
        ht.saleBody = '现货' or (ht.companyId = '1932' and ht.saleGroup = '科技部') or
        (ht.companyId = '8493' and ht.saleGroup = '营销中心' or
        ht.saleGroup = '1000') then
        ht.orderMount
        end) zgshtl,
        sum(case
        when ht.saleBody = '出口'
        or (ht.companyId = '1932' and ht.saleGroup = '舞钢国贸') then
        ht.orderMount
        end) ckhtl,
        jh.planNumxsz planNumxsz,
        jh.planNumzgs planNumzgs,
        jh.planNumck planNumck
        from (SELECT svtp.variety      pzName,
        xsztdzb.sale_body saleBody,
        sso.ORDER_MOUNT   orderMount,
        sso.SALE_GROUP saleGroup,
        sso.company_id companyId,
        sso.sale_body ssaleBody
        from scm_sale_order sso
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (select a.*
        from price_salebody_relation a
        where a.is_delete = 0) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        WHERE 1 = 1
        <if test="pzName != null and pzName != ''">
            and svtp.variety = #{pzName}
        </if>
        <if test="startTime != null and startTime != ''">
            and instr(sso.dj_date, #{startTime})>0
        </if>
        and sso.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5', '10')
        and cfd.status = '0'
        and cfd.company_id = sso.company_id)
        and sso.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = sso.company_id)
        AND sso.sale_group NOT IN
        (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = sso.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and sso.sale_group <![CDATA[ != ]]> 'C100'
        and sso.sale_group <![CDATA[ != ]]> 'K200'
        and sso.product_info <![CDATA[ != ]]> '连铸坯'
        and sso.SALE_GROUP not in
        (select ssa.sale_group
        from scm_sale_order ssa
        where ssa.company_id = '8493'
        and ssa.sale_group <![CDATA[ != ]]> '营销中心'
        and ssa.sale_group <![CDATA[ != ]]> '1000')
        and sso.SALE_GROUP not in
        (select ssa.sale_group
        from scm_sale_order ssa
        where ssa.company_id = '1932'
        and ssa.sale_group = '进出口公司')
        and sso.sale_body not in
        (select ssa.sale_body
        from scm_sale_order ssa
        where ssa.company_id = '9196'
        and ssa.sale_body = '河北经营部')
        and sso.sale_body <![CDATA[ != ]]> '唐钢中厚板公司'
        and sso.sale_body <![CDATA[ != ]]> '唐钢不锈钢公司') ht
        left join (select PZ_NAME pzName,
        sum(planNum) hjjhl,
        sum(case
        when fl_name = '销售总公司' then
        planNum
        end) planNumxsz,
        sum(case
        when fl_name = '出口' then
        planNum
        end) planNumck,
        sum(case
        when fl_name = '子公司其他' or fl_name = '技术中心、事业部' or
        fl_name = '现货' then
        planNum
        end) planNumzgs
        from (SELECT distinct PZ_NAME,
        APR_MONTH planNum,
        fl_name
        FROM crm_resource_allocation
        where year = #{year}
        and fl_name <![CDATA[ != ]]> '品种钢')
        group by PZ_NAME) jh
        on ht.pzName = jh.pzName
        group by ht.pzName,
        hjjhl,
        jh.planNumxsz,
        jh.planNumzgs,
        jh.planNumck)
        order by decode(pzName,
        '热板',
        1,
        '冷板',
        2,
        '宽厚板',
        3,
        '棒线',
        4,
        '型带',
        5)

    </select>

    <select id="getcxhtjd" resultType="map">
        select dName,
        decode(companyId,
        9580,
        '河钢唐钢',
        9727,
        '河钢邯钢',
        9193,
        '河钢宣钢',
        9196,
        '河钢承钢',
        1932,
        '河钢舞钢',
        8110,
        '河钢石钢',
        8493,
        '河钢衡板',
        7778,
        '河钢邯宝') companyId,
        case
        when hjhtl is null then
        0
        else
        hjhtl
        end hjhtl,
        case
        when hjjhl is null then
        0
        else
        hjjhl
        end hjjhl,
        case
        when hjjhl = 0 then
        0
        when hjhtl / hjjhl is null then
        0
        else
        ROUND(hjhtl / hjjhl * 100, 2)
        END AS schedulehj,
        case
        when zygshtl is null then
        0
        else
        zygshtl
        end zygshtl,
        case
        when zyfgshtl is null then
        0
        else
        zyfgshtl
        end zyfgshtl,
        case
        when planNumxsz is null then
        0
        else
        planNumxsz
        end planNumxsz,
        case
        when planNumxsz = 0 then
        0
        when htlzgs / planNumxsz is null then
        0
        else
        ROUND(htlzgs / planNumxsz * 100, 2)
        END AS schedulexsz,
        case
        when htlzgs = 0 or htlzgs is null then
        nvl(-planNumxsz,0)
        when planNumxsz = 0 or planNumxsz is null then
        htlzgs
        else
        htlzgs - planNumxsz
        end jdxsz,
        case
        when zgshtl is null then
        0
        else
        zgshtl
        end zgshtl,
        case
        when planNumzgs is null then
        0
        else
        planNumzgs
        end planNumzgs,
        case
        when planNumzgs = 0 then
        0
        when zgshtl / planNumzgs is null then
        0
        else
        ROUND(zgshtl / planNumzgs * 100, 2)
        END AS schedulezgs,
        case
        when zgshtl = 0 or zgshtl is null then
        nvl(-planNumzgs,0)
        when planNumzgs = 0 or planNumzgs is null then
        zgshtl
        else
        zgshtl - planNumzgs
        end jdzgs,
        case
        when ckhtl is null then
        0
        else
        ckhtl
        end ckhtl,
        case
        when planNumck is null then
        0
        else
        planNumck
        end planNumck,
        case
        when planNumck = 0 then
        0
        when ckhtl / planNumck is null then
        0
        else
        ROUND(ckhtl / planNumck * 100, 2)
        END AS scheduleck,
        case
        when ckhtl = 0 or ckhtl is null then
        nvl(-planNumck,0)
        when planNumck = 0 or planNumck is null then
        ckhtl
        else
        ckhtl - planNumck
        end jdck
        from (select distinct ht.dName dName,
        ht.companyId companyId,
        sum(ht.orderMount) hjhtl,
        hjjhl,
        sum(case
        when ht.saleBody = '专业公司' or ht.saleBody = '分公司' then
        ht.orderMount
        end) htlzgs,
        sum(case
        when ht.saleBody = '专业公司' then
        ht.orderMount
        end) zygshtl,
        sum(case
        when ht.saleBody = '分公司' then
        ht.orderMount
        end) zyfgshtl,
        sum(case
        when ht.saleBody = '技术中心' or ht.saleBody = '事业部' or
        ht.saleBody = '子公司' or ht.saleBody = '自办公司' or
        ht.saleBody = '现货' then
        ht.orderMount
        end) zgshtl,
        sum(case
        when ht.saleBody = '出口' then
        ht.orderMount
        end) ckhtl,
        jh.planNumxsz planNumxsz,
        jh.planNumzgs planNumzgs,
        jh.planNumck planNumck

        from (SELECT case
        when sso.company_id = '9580' and
        sso.product_code = '01' and
        sso.sale_group = '2005' then
        '唐钢1700/1810'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '2005' then
        '唐钢酸洗'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '2003' and
        sso.material_group_info = '冷轧低碳钢带（罩退）' then
        '唐钢一冷罩退'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '2003' and
        sso.material_group_info = '连续热镀锌钢带（热轧基板）' then
        '唐钢热基镀锌'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '2003' and
        sso.material_group_info = '连续热镀锌钢带（冷轧基板）' then
        '唐钢一冷冷基镀锌'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '2003' and
        sso.material_group_info = '冷轧硬钢带' then
        '唐钢一冷酸轧'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '1500' and
        sso.material_group_info = '冷轧硬钢带' then
        '唐钢二冷酸轧'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '1500' and
        sso.material_group_info = '冷轧低碳钢带（连退）' then
        '唐钢新区连退'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '1500' and
        sso.material_group_info = '连续热镀锌钢带（冷轧基板）' then
        '唐钢新区镀锌'
        when sso.company_id = '9580' and
        sso.product_code = '02' and
        sso.sale_group = '2003' and
        (sso.material_group_info <![CDATA[ != ]]> '冷轧低碳钢带（罩退）' and
        sso.material_group_info <![CDATA[ != ]]> '连续热镀锌钢带（热轧基板）' and
        sso.material_group_info <![CDATA[ != ]]> '连续热镀锌钢带（冷轧基板）' and
        sso.material_group_info <![CDATA[ != ]]> '冷轧硬钢带') or
        sso.sale_group = '1500' and
        (sso.material_group_info <![CDATA[ != ]]> '冷轧硬钢带' and
        sso.material_group_info <![CDATA[ != ]]> '冷轧低碳钢带（连退）' and
        sso.material_group_info <![CDATA[ != ]]> '连续热镀锌钢带（冷轧基板）') then
        '唐钢其他'
        when sso.company_id = '9580' and
        sso.product_code = '03' then
        '唐钢棒材'
        when sso.company_id = '9580' and
        sso.product_code = '04' then
        '唐钢线材'
        when sso.company_id = '9580' and
        sso.product_code = '05' and
        sso.sale_group = '2002' and
        sso.MATERIAL_CODE like '935%' then
        '唐钢中型'
        when sso.company_id = '9580' and
        sso.product_code = '01' and
        sso.sale_group = '4000' then
        '唐钢1580热轧线'
        when sso.company_id = '9580' and
        sso.product_code in ('21', '22', '23') then
        '唐钢中厚板'
        when sso.company_id = '9580' and
        sso.product_code = '05' and
        sso.sale_group = '2002' and
        sso.MATERIAL_CODE like '941%' then
        '唐钢大型'
        when sso.company_id = '7778' and
        sso.product_code = 'I' then
        '邯钢2250'
        when sso.company_id = '9727' and
        sso.product_code = '20' then
        '邯钢CSP'
        when sso.company_id = '9727' and
        sso.product_code = '21' then
        '邯钢酸洗'
        when sso.company_id = '9727' and
        sso.product_code = '31' then
        '邯钢一冷罩退'
        when sso.company_id = '9727' and
        sso.product_code = '22' then
        '邯钢热基镀锌'
        when sso.company_id = '9727' and
        sso.product_code = '33' and
        sso.material_code not like 'C4%' then
        '邯钢热基镀锌'
        when sso.company_id = '9727' and
        sso.product_code = '33' and
        sso.material_code like 'C4%' then
        '邯钢一冷冷基镀锌'
        when sso.company_id = '9727' and
        sso.product_code = '35' then
        '邯钢电镀锌'
        when sso.company_id = '9727' and
        sso.product_code = '34' then
        '邯钢彩涂'
        when sso.company_id = '9727' and
        sso.product_code = '30' then
        '邯钢酸轧'
        when sso.company_id = '7778' and
        sso.product_code = 'Z' then
        '邯宝酸轧'
        when sso.company_id = '7778' and
        sso.product_code = 'L' then
        '邯钢西区连退'
        when sso.company_id = '7778' and
        sso.product_code = 'M' then
        '邯钢西区镀锌'
        when sso.company_id = '7778' and
        sso.product_code = 'S' then
        '邯钢其他'
        when sso.company_id = '9727' and
        sso.product_code = '10' then
        '邯钢3000/3500'
        when sso.company_id = '9727' and
        sso.product_code = '01' and
        sso.sale_body != '优特钢' then
        '邯钢棒材'
        when sso.company_id = '9727' and
        sso.product_code = '02' and
        sso.sale_body != '优特钢' then
        '邯钢线材'
        when sso.company_id = '9727' and
        sso.product_code = '02' and
        sso.sale_body = '优特钢' then
        '邯钢新钢轧线材'
        when sso.company_id = '9727' and
        sso.product_code = '01' and
        sso.sale_body = '优特钢' then
        '邯钢新钢轧棒材'
        when sso.company_id = '9727' and
        sso.product_code = '03' then
        '邯钢新钢轧型材'
        when sso.company_id = '9193' and
        sso.product_code in ('01', '02') then
        '宣钢棒材'
        when sso.company_id = '9193' and
        sso.product_code = '03' then
        '宣钢一高线、二高线'
        when sso.company_id = '9193' and
        sso.product_code = '08' then
        '宣钢中型'
        when sso.company_id = '9193' and
        sso.product_code = '04' then
        '宣钢带钢'
        when sso.company_id = '9196' and
        sso.product_code = '10' then
        '承钢1780'
        when sso.company_id = '9196' and
        sso.product_code = '40' and
        sso.MATERIAL_CODE like '501%' then
        '承钢棒材'
        when sso.company_id = '9196' and
        sso.product_code = '40' and
        sso.MATERIAL_CODE like '502%' then
        '承钢线材'
        when sso.company_id = '9196' and
        sso.product_code = '50' then
        '承钢中宽带'
        when sso.company_id = '1932' and
        sso.product_code = 'J' then
        '舞钢4100/4200'
        when sso.company_id = '8110' then
        '石钢棒材'
        when sso.company_id = '8493' then
        '衡板冷板'
        end dName,
        xsztdzb.sale_body saleBody,
        sso.ORDER_MOUNT orderMount,
        sso.company_id companyId
        from scm_sale_order sso
        left join (select a.*
        from price_salebody_relation a
        where a.is_delete = 0) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des

        WHERE 1 = 1
        <if test="startTime != null and startTime != ''">
            and instr(sso.dj_date, #{startTime})>0
        </if>
        and sso.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5', '1', '7', '9')
        and cfd.status = '0'
        and cfd.company_id = sso.company_id)
        and sso.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = sso.company_id)
        and sso.sale_group not in
        (SELECT sso.sale_group
        FROM crm_filter_data cfd
        where cfd.company_id = sso.company_id
        and instr(sso.sale_group, cfd.data_name, 1, 1) > 0
        and cfd.data_type = 4
        and cfd.status = 0)
        and sso.sale_group <![CDATA[ != ]]> 'C100'
        and sso.sale_group <![CDATA[ != ]]> 'K200'
        and sso.product_info <![CDATA[ != ]]> '连铸坯'
        ) ht
        left join (select cx_NAME,
        sum(planNum) hjjhl,
        sum(case
        when fl_name = '销售总公司' then
        planNum
        end) planNumxsz,
        sum(case
        when fl_name = '出口' then
        planNum
        end) planNumck,
        sum(case
        when fl_name = '子公司其他' or fl_name = '技术中心、事业部' or
        fl_name = '现货' then
        planNum
        end) planNumzgs
        from (SELECT cx_NAME, CASE
                            WHEN #{month} = '01' THEN
                            JAN_MONTH
                            WHEN #{month} = '02' THEN
                            FEB_MONTH
                            WHEN #{month} = '03' THEN
                            MAR_MONTH
                            WHEN #{month} = '04' THEN
                            APR_MONTH
                            WHEN #{month} = '05' THEN
                            MAY_MONTH
                            WHEN #{month} = '06' THEN
                            JUN_MONTH
                            WHEN #{month} = '07' THEN
                            JUL_MONTH
                            WHEN #{month} = '08' THEN
                            AUG_MONTH
                            WHEN #{month} = '09' THEN
                            SEP_MONTH
                            WHEN #{month} = '10' THEN
                            OCT_MONTH
                            WHEN #{month} = '11' THEN
                            NOV_MONTH
                            WHEN #{month} = '12' THEN
                            DEC_MONTH
                            END planNum, fl_name
        FROM crm_resource_allocation
        where year = #{year}
        and fl_Name <![CDATA[ != ]]> '品种钢')
        group by cx_NAME) jh
        on ht.dName = jh.cx_name
        where 1=1
        <if test=" cxName != null and cxName.size > 0">
            and ht.dName in
            <foreach item="item" index="index" collection="cxName" open="(" separator="," close=")">
                　　　　#{item}
            </foreach>
        </if>
        group by ht.dName,
        ht.companyId,
        hjjhl,
        jh.planNumxsz,
        jh.planNumzgs,
        jh.planNumck)
        where 1=1
        <if test="companyId != null and companyId != ''">
            and companyId = #{companyId}
        </if>
        and dName <![CDATA[ != ]]> '唐钢1580热轧线' and dName <![CDATA[ != ]]> '唐钢中厚板'
        order by decode(companyId,'河钢唐钢',1,'河钢邯钢',2,'河钢宣钢',3,'河钢承钢',4,'河钢舞钢',5,'河钢石钢',6,'河钢衡板',7,'河钢邯宝',8)
    </select>

    <select id="selCx" resultType="map">
        select
        cx_name cx
        from CRM_CX_NAME
        where 1=1
        <if test="companyId != null and companyId != ''">
            and company_id = #{companyId}
        </if>
        order by decode(company_id,'9580',1,'9727',2,'7778',3,'9193',4,'9196',5,'1932',6,'8110',7,'8493',8)
    </select>

    <select id="getCxNamePzg" resultType="map">
        select distinct name cx
        from CRM_RESOURCE_DATA
        where 1=1
        <if test="companyId != '' and companyId!= '全部' and companyId!= null">
            and company_id = #{companyId}
        </if>
        and type = '6'
        <if test=" type == null ">
            and name <![CDATA[ != ]]> '唐钢1580热轧线'  and  name <![CDATA[ != ]]> '唐钢中厚板'
        </if>


    </select>

    <select id="getyxybpz" resultType="map">

        select nvl(name,'合计') COMPANYNAME,"SUM"(kzwi6)/10000 kzwi6,sum(FKIMG) FKIMG,sum(kzwi6)/sum(FKIMG) sj from
        (select NAME,kzwi6, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)+ NVL(ckfkimg,0)) FKIMG,zyfkimg,fgsfkimg,zgsfkimg,ckfkimg
        from (SELECT
        NAME,"SUM"(kzwi6) kzwi6,
        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')
        and sale_body = '专业公司' or sale_body = '专业公司' then fkimg end)
        zyfkimg,

        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,

        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部' or sale_body='子公司' or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
        zgsfkimg,

        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='出口')  then fkimg end)
        ckfkimg

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  != 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat<![CDATA[ >= ]]> to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <![CDATA[ <= ]]> to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

        and  settle.company_id in ('9580','9727','9193')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name ) a



        union all
        (select NAME COMPANYNAME,kzwi6, (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)+ NVL(ckfkimg,0)) FKIMG,zyfkimg,fgsfkimg,zgsfkimg,ckfkimg
        from (
        SELECT

        NAME,
        "SUM"(kzwi6) kzwi6,
        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '专业公司' then fkimg end)
        zyfkimg,
        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
        zgsfkimg,
        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='出口')  then fkimg end)
        ckfkimg

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  != 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat<![CDATA[ >= ]]> to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <![CDATA[ <= ]]> to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('9196')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.name )
        )


        union all

        ( select name,kzwi6,(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)+nvl(ckfkimg,0)) fkimg,zyfkimg,fgsfkimg,zgsfkimg,ckfkimg
        from(select  name,"SUM"(kzwi6) kzwi6,
        sum(case when company_id = '1932'  then
        case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end end)
        zyfkimg,

        sum( case when company_id='8110' then
        case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sggl = '分公司'  or sggl = '出口'  then fkimg end else null end )
        fgsfkimg,

        sum(case when company_id = '1932'  then
        case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,

        sum(case when fkdat <![CDATA[ >= ]]> to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  <![CDATA[ <= ]]> to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '舞钢国贸') or sggl ='出口' then fkimg end)
        ckfkimg

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  != 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat<![CDATA[ >= ]]> to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <![CDATA[ <= ]]> to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by t.name  ))

        )
        <if test="pz != '' and pz!= '全部' and pz!= null and pz != 'undefined'">

            where NAME = #{pz}

        </if>
         group by rollup(name)
   </select>

    <select id="getyxybgc" resultType="map">

select COMPANYNAME,kzwi6/10000 kzwi6 ,FKIMG,CASE WHEN FKIMG=0 THEN 0 ELSE  kzwi6/FKIMG END  sj
from (select
        COMPANYNAME, kzwi6 ,(NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)+ NVL(ckfkimg,0)) FKIMG, ZYFKIMG,  FGSFKIMG,   ZGSFKIMG
        from (SELECT
        COMPANYNAME,
				"SUM"(kzwi6) kzwi6,
        sum(case when  (sale_body = '专业公司'  ) then fkimg end)zyfkimg,
				sum(case when  (sale_body = '专业公司' ) then kzwi6 end)zykzwi6,
        sum(case when  (sale_body = '分公司'  ) then fkimg end)fgsfkimg,
				sum(case when  (sale_body = '分公司'  ) then kzwi6 end)fgskzwi6,
        sum(case when (sale_body ='事业部' or sale_body='子公司'  or sale_body  = '现货' or sale_body='自办公司')   then fkimg end)
				zgsfkimg,
				sum(case when (sale_body ='事业部' or sale_body='子公司'   or sale_body  = '现货' or sale_body='自办公司')   then kzwi6 end)
				zgskzwi6,
				sum(case when  sale_body = '出口'    then fkimg end)
				ckfkimg

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
         group by  t.companyname) a

        union all (
        select
        COMPANYNAME,kzwi6,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)+ NVL(ckfkimg,0)) FKIMG,  ZYFKIMG,FGSFKIMG,   ZGSFKIMG
        from (SELECT
        COMPANYNAME,
				"SUM"(kzwi6) kzwi6,
        sum(case when (sale_body = '专业公司') then fkimg end)zyfkimg,
				sum(case when (sale_body = '专业公司') then kzwi6 end)zykzwi6,
        sum(case when sale_body = '分公司'  then fkimg end)fgsfkimg,
				sum(case when sale_body = '分公司'  then kzwi6 end)fgskzwi6,
        sum(case when (sale_body ='事业部'   or sale_body  = '现货' or sale_body='自办公司')   then fkimg end) zgsfkimg,
				sum(case when (sale_body ='事业部'   or sale_body  = '现货' or sale_body='自办公司')   then kzwi6 end) zgskzwi6,
				 sum(case when sale_body ='出口'  then fkimg end)
        ckfkimg

          from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
         group by  t.companyname) a
        )

        union all
        ( select companyname, kzwi6 ,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) +nvl(ckfkimg,0) fkimg,
        zyfkimg,fgsfkimg,zgsfkimg
        from(
			select  companyname,"SUM"(kzwi6) kzwi6,
       sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部'   then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部'   then case when kzwi6 is null then '0' else kzwi6 end end)
        zykzwi6,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'   or sggl = '出口' )  then fkimg end else null end )
        fgsfkimg,
				sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'   or sggl = '出口' )  then kzwi6 end else null end )
        fgskzwi6,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部' )  then fkimg end

				when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000'    )  then fkimg end end)
        zgsfkimg,
				sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部'   )  then kzwi6 end
				when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000'  )  then kzwi6 end end)
        zgskzwi6,
				sum(case when fkdat &gt;=to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '舞钢国贸') or sggl ='出口' then fkimg end)
        ckfkimg

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME &lt;&gt; '唐钢1580热轧线'  and  t.name &lt;&gt; '唐钢中厚板'
        group by  t.companyname  )
        )

)
 where 1=1  <if test="gc != '' and gc!= '全部' and gc!= null and gc != 'undefined'">

        and companyname = #{gc}

    </if>
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板'，'7')

 </select>

    <select  id = "getxsjswc" resultType="map">


SELECT zl, cxname,fkimg,kzwi6,zsj,
nvl(nmfkimg,0) nmfkimg,nmkzwi6,nvl(nmsj,0) nmsj,
nvl(xszgsfkimg,0) xszgsfkimg,nvl(xszgskzwi6,0) xszgskzwi6,decode(xszgsfkimg,0,0,xszgskzwi6/xszgsfkimg) xszgssj,
nvl(zyfkimg,0) zyfkimg, nvl(zykzwi6,0) zykzwi6,nvl(zygssj,0) zysj,
nvl(fgsfkimg,0) fgsfkimg,nvl(fgskzwi6,0) fgskzwi6,nvl(fgssj,0) fgssj,
nvl(zgsfkimg,0) zgsfkimg,nvl(zgskzwi6,0) zgskzwi6,decode(zgsfkimg,0,0,zgskzwi6/zgsfkimg) zgssj ,
nvl( xhfkimg,0) xhfkimg,nvl(xhkzwi6,0) xhkzwi6,nvl(xhsj,0) xhsj,
 nvl(sybfkimg,0) sybfkimg,nvl(sybkzwi6,0) sybkzwi6,nvl(sybsj,0) sybsj,
nvl(zbgsfkimg,0) zbgsfkimg,nvl(zbgskzwi6,0) zbgskzwi6,nvl(zbgssj,0) zbgssj,
nvl(ckfkimg,0) ckfkimg,nvl(ckkzwi6,0) ckkzwi6,nvl(cksj,0) cksj
from
(
select
zl,cxname,fkimg,kzwi6/10000 kzwi6, decode(fkimg,0,0,kzwi6/fkimg) zsj,
nmfkimg ,nmkzwi6,decode(nmfkimg,0,0,nmkzwi6/nmfkimg) nmsj,
nvl(zyfkimg,0)+nvl(fgsfkimg,0) xszgsfkimg,nvl(zykzwi6,0)+ nvl(fgskzwi6,0) xszgskzwi6,
zyfkimg ,zykzwi6,decode(zyfkimg,0,0,zykzwi6/zyfkimg) as zygssj,
fgsfkimg ,fgskzwi6,decode(fgsfkimg,0,0,fgskzwi6/fgsfkimg) as fgssj,
nvl(xhfkimg,0)+ nvl(sybfkimg,0) zgsfkimg,
nvl(xhkzwi6,0)+ nvl(sybkzwi6,0) zgskzwi6,
xhfkimg ,xhkzwi6,decode(xhfkimg,0,0,xhkzwi6/xhfkimg)  as xhsj,
sybfkimg ,sybkzwi6,decode(sybfkimg,0,0,sybkzwi6/sybfkimg) as sybsj,
zbgsfkimg ,zbgskzwi6,decode(zbgsfkimg,0,0,zbgskzwi6/zbgsfkimg) as zbgssj,
ckfkimg ,ckkzwi6,decode(ckfkimg,0,0,ckkzwi6/ckfkimg) as cksj
from

	(
select zl, case when cxname IS null then companyname||'其他' else cxname end cxname,
("NVL"(zyfkimg, 0)+"NVL"(fgsfkimg, 0)+"NVL"(xhfkimg, 0)+"NVL"(sybfkimg, 0)+"NVL"(zbgsfkimg, 0)+"NVL"(ckfkimg, 0)) fkimg,
 kzwi6,

("NVL"(zyfkimg, 0)+"NVL"(fgsfkimg, 0)+"NVL"(xhfkimg, 0)+"NVL"(sybfkimg, 0)+"NVL"(zbgsfkimg, 0)) nmfkimg,
("NVL"(zykzwi6, 0)+"NVL"(fgskzwi6, 0)+"NVL"(xhkzwi6, 0)+"NVL"(sybkzwi6, 0)+"NVL"(zbgskzwi6, 0) )	nmkzwi6,
zyfkimg,zykzwi6,
fgsfkimg,fgskzwi6,
xhfkimg,xhkzwi6,
sybfkimg,sybkzwi6,
zbgsfkimg,zbgskzwi6,
ckfkimg,ckkzwi6
        from (SELECT
        zl,companyname,cxname,"SUM"(kzwi6) kzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')and sale_body = '专业公司'  then fkimg end)
        zyfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss')and sale_body = '专业公司'  then kzwi6 end)
        zykzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then fkimg end)
        fgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body = '分公司' then kzwi6 end)
        fgskzwi6,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body  = '现货' then fkimg end)
        xhfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_body  = '现货' then kzwi6 end)
        xhkzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部' or sale_body='子公司' )   then fkimg end)
        sybfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='事业部'or sale_body='子公司'  )   then kzwi6 end)
        sybkzwi6,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body  = '自办公司') then fkimg end)
        zbgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body  = '自办公司' ) then kzwi6 end)
        zbgskzwi6,
        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='出口')  then fkimg end)
        ckfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;= to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_body ='出口')  then kzwi6 end)
        ckkzwi6

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
       (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) cxname,
				 (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) zl,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  != 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 )

xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class



        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

        and  settle.company_id in ('9580','9727','9193')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        group by  zl,cxname,companyname )
        order by decode(zl,'河钢集团',1,'热板',2,'酸洗',3,'冷板',4,'镀锌',5,'中厚板',6,'螺纹钢',7,'圆钢',8,'线材',9,'型材',10,'薄板',11,'新材',12,'涂镀',13,'冷轧',14)

)  a
UNION
select
zl,cxname ,fkimg,kzwi6/10000 kzwi6,decode(fkimg,0,0,kzwi6/fkimg) zsj,
nmfkimg ,nmkzwi6,decode(nmfkimg,0,0,nmkzwi6/nmfkimg) nmsj,
nvl(zyfkimg,0)+nvl(fgsfkimg,0) xszgsfkimg,nvl(zykzwi6,0)+ nvl(fgskzwi6,0) xszgskzwi6,
zyfkimg ,zykzwi6,decode(zyfkimg,0,0,zykzwi6/zyfkimg) as zygssj,
fgsfkimg ,fgskzwi6,decode(fgsfkimg,0,0,fgskzwi6/fgsfkimg) as fgssj,
nvl(xhfkimg,0)+ nvl(sybfkimg,0) zgsfkimg,
nvl(xhkzwi6,0)+ nvl(sybkzwi6,0) zgskzwi6,
xhfkimg ,xhkzwi6,decode(xhfkimg,0,0,xhkzwi6/xhfkimg) as xhsj,
sybfkimg ,sybkzwi6,decode(sybfkimg,0,0,sybkzwi6/sybfkimg) as sybsj,
zbgsfkimg ,zbgskzwi6,decode(zbgsfkimg,0,0,zbgskzwi6/zbgsfkimg) as zbgssj,
ckfkimg ,ckkzwi6,decode(ckfkimg,0,0,ckkzwi6/ckfkimg) as cksj
from
(select zl, case when cxname IS null then companyname||'其他' else cxname end cxname,
(nvl(zyfkimg,0)+nvl(fgsfkimg,0)+ nvl(xhfkimg,0)+ NVL(sybfkimg,0)+ NVL(zbgsfkimg,0)+ NVL(ckfkimg,0)) fkimg,
 kzwi6,
("NVL"(zyfkimg, 0)+"NVL"(fgsfkimg, 0)+"NVL"(xhfkimg, 0)+"NVL"(sybfkimg, 0)+"NVL"(zbgsfkimg, 0)) nmfkimg,
("NVL"(zykzwi6, 0)+"NVL"(fgskzwi6, 0)+"NVL"(xhkzwi6, 0)+"NVL"(sybkzwi6, 0)+"NVL"(zbgskzwi6, 0) )	nmkzwi6,
zyfkimg,zykzwi6,
fgsfkimg,fgskzwi6,
xhkzwi6,xhfkimg,
sybfkimg,sybkzwi6,
zbgsfkimg,zbgskzwi6,
ckfkimg,ckkzwi6
        from(
select  zl, companyname, cxname,"SUM"(kzwi6) kzwi6,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end end)
        zyfkimg,
				sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when kzwi6 is null then '0' else kzwi6 end end end)
        zykzwi6,
        sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sggl = '分公司' or sggl = '出口'  then fkimg end else null end )
        fgsfkimg,
				sum( case when company_id='8110' then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and sggl = '分公司' or sggl = '出口' then kzwi6 end else null end )
        fgskzwi6,
        sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        sybfkimg,
				sum(case when company_id = '1932'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then kzwi6 end
        when company_id ='8493'  then
        case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then kzwi6 end end)
        sybkzwi6,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '现货')  then fkimg end)
        xhfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '现货')  then kzwi6 end)
        xhkzwi6,

				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '自办公司')  then fkimg end)
        zbgsfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '自办公司')  then kzwi6 end)
        zbgskzwi6,

        sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '舞钢国贸')  or sggl = '出口'  then fkimg end)
        ckfkimg,
				sum(case when fkdat &gt;= to_date (#{startTime},'yyyy-mm-dd hh24:mi:ss') and fkdat  &lt;=  to_date (#{endTime},'yyyy-mm-dd hh24:mi:ss') and (company_id = '1932' and sale_group = '舞钢国贸') or sggl = '出口'   then kzwi6 end)
        ckkzwi6

        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
				(select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) cxname,
				 (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) zl,
        (select case when  B.company_id ='8110' then '特钢' when B.company_id ='8493'then '薄板' else b.variety end VARIETY
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) name,
        (select max(detail.ext)
        from scm_delivery_detail detail

        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  != 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class



        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;=  to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
         group by cxname,zl,companyname  ))
UNION
select
zl,cxname ,fkimg,kzwi6/10000 kzwi6,decode(fkimg,0,0,kzwi6/fkimg) zsj,
nmfkimg ,nmkzwi6,decode(nmfkimg,0,0,nmkzwi6/nmfkimg) nmsj,
nvl(zyfkimg,0)+nvl(fgsfkimg,0) xszgsfkimg,nvl(zykzwi6,0)+ nvl(fgskzwi6,0) xszgskzwi6,
zyfkimg ,zykzwi6,decode(zyfkimg,0,0,zykzwi6/zyfkimg) as zygssj,
fgsfkimg ,fgskzwi6,decode(fgsfkimg,0,0,fgskzwi6/fgsfkimg) as fgssj,
nvl(xhfkimg,0)+ nvl(sybfkimg,0) zgsfkimg,
nvl(xhkzwi6,0)+ nvl(sybkzwi6,0) zgskzwi6,
xhfkimg ,xhkzwi6,decode(xhfkimg,0,0,xhkzwi6/xhfkimg) as xhsj,
sybfkimg ,sybkzwi6,decode(sybfkimg,0,0,sybkzwi6/sybfkimg) as sybsj,
zbgsfkimg ,zbgskzwi6,decode(zbgsfkimg,0,0,zbgskzwi6/zbgsfkimg) as zbgssj,
ckfkimg ,ckkzwi6,decode(ckfkimg,0,0,ckkzwi6/ckfkimg) as cksj
from
 (		SELECT zl,case when cxname IS null then companyname||'其他' else cxname end cxname,
("NVL"(zyfkimg, 0)+"NVL"(fgsfkimg, 0)+"NVL"(xhfkimg, 0)+"NVL"(sybfkimg, 0)+"NVL"(zbgsfkimg, 0)+"NVL"(ckfkimg, 0)) fkimg,
 kzwi6,
("NVL"(zyfkimg, 0)+"NVL"(fgsfkimg, 0)+"NVL"(xhfkimg, 0)+"NVL"(sybfkimg, 0)+"NVL"(zbgsfkimg, 0)) nmfkimg,
("NVL"(zykzwi6, 0)+"NVL"(fgskzwi6, 0)+"NVL"(xhkzwi6, 0)+"NVL"(sybkzwi6, 0)+"NVL"(zbgskzwi6, 0) )	nmkzwi6,
zyfkimg,zykzwi6,
fgsfkimg,fgskzwi6,
xhfkimg,xhkzwi6,
sybfkimg,sybkzwi6,
zbgsfkimg,zbgskzwi6,
ckfkimg,ckkzwi6
 FROM (
        SELECT
				zl, companyname, cxname,
				"SUM"(kzwi6) kzwi6,
        sum(case when ( sale_body = '出口') then fkimg end)ckfkimg,
				sum(case when ( sale_body = '出口') then kzwi6 end)ckkzwi6,
        sum(case when (sale_body = '专业公司') then fkimg end)zyfkimg,
				sum(case when (sale_body = '专业公司') then kzwi6 end)zykzwi6,
        sum(case when sale_body = '分公司'  then fkimg end)fgsfkimg,
				sum(case when sale_body = '分公司'  then kzwi6 end)fgskzwi6,
        sum(case when sale_body  = '现货'  then fkimg end)xhfkimg,
				sum(case when sale_body  = '现货'  then kzwi6 end)xhkzwi6,
				sum(case when (sale_body ='自办公司' )  then fkimg end)zbgsfkimg,
				sum(case when (sale_body ='自办公司' )  then kzwi6 end)zbgskzwi6,
				sum(case when (sale_body ='事业部')    then fkimg end) sybfkimg,
				sum(case when (sale_body ='事业部' )    then kzwi6 end) sybkzwi6
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
				settle.kzwi6,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
				(select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X' or
        detail.delivery_delete is null)) cxname,
         (select max(B.VARIETY)
        from scm_sale_order sso
        JOIN scm_variety_to_pt_gp B
        ON sso.product_code = B.product_group
        and sso.company_id = B.company_id
        where sso.order_no = settle.aubel
        and sso.ORDER_ROW = settle.AUPOS
        AND sso.company_id = settle.company_id) zl,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  &lt;&gt; 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class

        where
        settle.fkdat&gt;= to_date(#{startTime}, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat &lt;= to_date(#{endTime}, 'yyyy-mm-dd hh24:mi:ss')

        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','10')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) &gt; 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
         group by zl,cxname,companyname)
        )

)   where 1 = 1
        <if test="pz != '' and pz!= '全部' and pz!= null and pz != 'undefined'">

            and zl = #{pz}

        </if>
        <if test="cx != null and  cx.size > 0">
            and   cxname in
            <foreach item="item" index="index" collection="cx" open="(" separator="," close=")">
                　　#{item}
            </foreach>
        </if>
ORDER BY    "DECODE"(zl,'热板','1','冷板','2','宽厚板','3','棒线','4','型带','5','特钢','6','薄板','7'),cxname

    </select>
</mapper>
