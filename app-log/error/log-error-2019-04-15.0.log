2019-04-15 10:11:39.145 ERROR 7536 --- [restartedMain] com.alibaba.druid.pool.DruidDataSource   : init datasource error, url: jdbc:oracle:thin:@18.0.126.1:1521:coredb1

java.sql.SQLException: The Network Adapter could not establish the connection
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:412)
	at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)
	at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:156)
	at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:218)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:786)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1572)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1636)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:874)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1870)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1813)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1741)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:576)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:857)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:760)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1288)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1127)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1467)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1362)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:575)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:224)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1112)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:407)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:335)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1101)
	at cn.stylefeng.roses.core.util.SpringContextHolder.getBean(SpringContextHolder.java:50)
	at cn.hbis.erp.core.common.constant.factory.ConstantFactory.<init>(ConstantFactory.java:30)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:172)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:87)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1262)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:846)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:863)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:316)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
	at cn.hbis.erp.HbisApplication.main(HbisApplication.java:36)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49)
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:359)
	at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:422)
	at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:672)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:237)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)
	... 86 common frames omitted
Caused by: java.net.ConnectException: Connection timed out: connect
	at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:141)
	at oracle.net.nt.ConnOption.connect(ConnOption.java:123)
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:337)
	... 91 common frames omitted

2019-04-15 10:11:39.175 ERROR 7536 --- [restartedMain] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} init error

java.sql.SQLException: The Network Adapter could not establish the connection
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:412)
	at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)
	at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:156)
	at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:218)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:786)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1572)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1636)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:874)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1870)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1813)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1741)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:576)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:857)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:760)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1288)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1127)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1467)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1362)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:575)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:224)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1112)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:407)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:335)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1101)
	at cn.stylefeng.roses.core.util.SpringContextHolder.getBean(SpringContextHolder.java:50)
	at cn.hbis.erp.core.common.constant.factory.ConstantFactory.<init>(ConstantFactory.java:30)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:172)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:87)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1262)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:846)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:863)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:316)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
	at cn.hbis.erp.HbisApplication.main(HbisApplication.java:36)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49)
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:359)
	at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:422)
	at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:672)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:237)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)
	... 86 common frames omitted
Caused by: java.net.ConnectException: Connection timed out: connect
	at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:141)
	at oracle.net.nt.ConnOption.connect(ConnOption.java:123)
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:337)
	... 91 common frames omitted

2019-04-15 10:11:39.416 ERROR 7536 --- [restartedMain] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'constantFactory' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\core\common\constant\factory\ConstantFactory.class]: Instantiation of bean failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [cn.hbis.erp.core.common.constant.factory.ConstantFactory]: Constructor threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleMapper' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\RoleMapper.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1270)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:846)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:863)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:316)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
	at cn.hbis.erp.HbisApplication.main(HbisApplication.java:36)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49)
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [cn.hbis.erp.core.common.constant.factory.ConstantFactory]: Constructor threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleMapper' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\RoleMapper.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:184)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:87)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1262)
	... 22 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleMapper' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\RoleMapper.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1482)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1362)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:575)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:224)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1112)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:407)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:335)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1101)
	at cn.stylefeng.roses.core.util.SpringContextHolder.getBean(SpringContextHolder.java:50)
	at cn.hbis.erp.core.common.constant.factory.ConstantFactory.<init>(ConstantFactory.java:30)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:172)
	... 24 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:769)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1288)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1127)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1467)
	... 43 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1745)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:576)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:857)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:760)
	... 56 common frames omitted
Caused by: java.sql.SQLException: The Network Adapter could not establish the connection
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:412)
	at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)
	at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:156)
	at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:218)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:786)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1572)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1636)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:874)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1870)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1813)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1741)
	... 67 common frames omitted
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:359)
	at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:422)
	at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:672)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:237)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)
	... 86 common frames omitted
Caused by: java.net.ConnectException: Connection timed out: connect
	at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:141)
	at oracle.net.nt.ConnOption.connect(ConnOption.java:123)
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:337)
	... 91 common frames omitted

2019-04-15 15:30:48.921 ERROR 1468 --- [http-nio-8081-exec-7] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

java.lang.NullPointerException: null
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$59572ca4.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)

2019-04-15 15:31:31.883 ERROR 1468 --- [http-nio-8081-exec-8] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

java.lang.NullPointerException: null
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$59572ca4.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)

2019-04-15 15:32:08.020 ERROR 1468 --- [http-nio-8081-exec-9] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

java.lang.NullPointerException: null
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$59572ca4.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)

2019-04-15 15:41:25.683 ERROR 7392 --- [http-nio-8081-exec-8] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

java.lang.NullPointerException: null
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$8ceafc9f.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)

2019-04-15 15:41:48.759 ERROR 7392 --- [http-nio-8081-exec-9] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

java.lang.NullPointerException: null
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$8ceafc9f.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)

2019-04-15 17:33:36.645 ERROR 2924 --- [http-nio-8081-exec-7] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

java.lang.NullPointerException: null
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$4f8a7598.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)

2019-04-15 17:33:48.647 ERROR 2924 --- [http-nio-8081-exec-8] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 411, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG*100,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG*100,2) END  wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 411, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG*100,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 411, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG*100,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7'); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 411, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG*100,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$225918d7.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:140)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$4f8a7598.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 411, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG*100,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 411, line 2, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

2019-04-15 17:37:03.970 ERROR 1596 --- [http-nio-8081-exec-7] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 454, line 3, column 194, token FROM : select name,jsl,pzgl,rounde(wcl*100,2) wcl from(
       select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
          )
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select name,jsl,pzgl,rounde(wcl*100,2) wcl from(        select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')           )
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 454, line 3, column 194, token FROM : select name,jsl,pzgl,rounde(wcl*100,2) wcl from(
       select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
          )
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 454, line 3, column 194, token FROM : select name,jsl,pzgl,rounde(wcl*100,2) wcl from(
       select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
          ); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 454, line 3, column 194, token FROM : select name,jsl,pzgl,rounde(wcl*100,2) wcl from(
       select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
          )
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$40eb5fe1.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:140)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$11f150ff.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 454, line 3, column 194, token FROM : select name,jsl,pzgl,rounde(wcl*100,2) wcl from(
       select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
          )
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 454, line 3, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:622)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

2019-04-15 17:39:51.925 ERROR 9760 --- [http-nio-8081-exec-7] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7'); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$4dca9c47.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:140)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$397e3f88.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

2019-04-15 17:43:36.251 ERROR 3196 --- [http-nio-8081-exec-9] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7'); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$22c32658.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:140)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$30b2dfce.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

2019-04-15 17:53:50.122 ERROR 9852 --- [restartedMain] com.alibaba.druid.pool.DruidDataSource   : init datasource error, url: jdbc:oracle:thin:@18.0.126.1:1521:coredb1

java.sql.SQLException: The Network Adapter could not establish the connection
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:412)
	at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)
	at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:156)
	at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:218)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:786)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1572)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1636)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:874)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1870)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1813)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1741)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:576)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:857)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:760)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1288)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1127)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1467)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1362)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:575)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:224)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1112)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:407)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:335)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1101)
	at cn.stylefeng.roses.core.util.SpringContextHolder.getBean(SpringContextHolder.java:50)
	at cn.hbis.erp.core.common.constant.factory.ConstantFactory.<init>(ConstantFactory.java:30)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:172)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:87)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1262)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:846)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:863)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:316)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
	at cn.hbis.erp.HbisApplication.main(HbisApplication.java:36)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49)
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:359)
	at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:422)
	at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:672)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:237)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)
	... 86 common frames omitted
Caused by: java.net.ConnectException: Connection timed out: connect
	at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:141)
	at oracle.net.nt.ConnOption.connect(ConnOption.java:123)
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:337)
	... 91 common frames omitted

2019-04-15 17:53:50.139 ERROR 9852 --- [restartedMain] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} init error

java.sql.SQLException: The Network Adapter could not establish the connection
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:412)
	at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)
	at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:156)
	at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:218)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:786)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1572)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1636)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:874)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1870)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1813)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1741)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:576)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:857)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:760)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1288)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1127)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1467)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1362)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:575)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:224)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1112)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:407)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:335)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1101)
	at cn.stylefeng.roses.core.util.SpringContextHolder.getBean(SpringContextHolder.java:50)
	at cn.hbis.erp.core.common.constant.factory.ConstantFactory.<init>(ConstantFactory.java:30)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:172)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:87)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1262)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:846)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:863)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:316)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
	at cn.hbis.erp.HbisApplication.main(HbisApplication.java:36)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49)
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:359)
	at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:422)
	at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:672)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:237)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)
	... 86 common frames omitted
Caused by: java.net.ConnectException: Connection timed out: connect
	at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:141)
	at oracle.net.nt.ConnOption.connect(ConnOption.java:123)
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:337)
	... 91 common frames omitted

2019-04-15 17:53:50.405 ERROR 9852 --- [restartedMain] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'constantFactory' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\core\common\constant\factory\ConstantFactory.class]: Instantiation of bean failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [cn.hbis.erp.core.common.constant.factory.ConstantFactory]: Constructor threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleMapper' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\RoleMapper.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1270)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:846)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:863)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:546)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:142)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:775)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:316)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1260)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1248)
	at cn.hbis.erp.HbisApplication.main(HbisApplication.java:36)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:49)
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [cn.hbis.erp.core.common.constant.factory.ConstantFactory]: Constructor threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleMapper' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\RoleMapper.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:184)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:87)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateBean(AbstractAutowireCapableBeanFactory.java:1262)
	... 22 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleMapper' defined in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\RoleMapper.class]: Unsatisfied dependency expressed through bean property 'sqlSessionFactory'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1482)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1362)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:575)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:224)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1112)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:407)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:335)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1101)
	at cn.stylefeng.roses.core.util.SpringContextHolder.getBean(SpringContextHolder.java:50)
	at cn.hbis.erp.core.common.constant.factory.ConstantFactory.<init>(ConstantFactory.java:30)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:172)
	... 24 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlSessionFactory' defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Unsatisfied dependency expressed through method 'sqlSessionFactory' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:769)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:509)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1288)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1127)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:538)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1467)
	... 43 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [cn/stylefeng/roses/core/config/MybatisDataSourceAutoConfiguration.class]: Invocation of init method failed; nested exception is java.sql.SQLException: The Network Adapter could not establish the connection
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1745)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:576)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:498)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:273)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1237)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1164)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:857)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:760)
	... 56 common frames omitted
Caused by: java.sql.SQLException: The Network Adapter could not establish the connection
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:412)
	at oracle.jdbc.driver.PhysicalConnection.<init>(PhysicalConnection.java:531)
	at oracle.jdbc.driver.T4CConnection.<init>(T4CConnection.java:221)
	at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:32)
	at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:503)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:156)
	at com.alibaba.druid.filter.stat.StatFilter.connection_connect(StatFilter.java:218)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.filter.FilterAdapter.connection_connect(FilterAdapter.java:786)
	at com.alibaba.druid.filter.FilterChainImpl.connection_connect(FilterChainImpl.java:150)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1572)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1636)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:874)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeCustomInitMethod(AbstractAutowireCapableBeanFactory.java:1870)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1813)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1741)
	... 67 common frames omitted
Caused by: oracle.net.ns.NetException: The Network Adapter could not establish the connection
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:359)
	at oracle.net.resolver.AddrResolution.resolveAndExecute(AddrResolution.java:422)
	at oracle.net.ns.NSProtocol.establishConnection(NSProtocol.java:672)
	at oracle.net.ns.NSProtocol.connect(NSProtocol.java:237)
	at oracle.jdbc.driver.T4CConnection.connect(T4CConnection.java:1042)
	at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:301)
	... 86 common frames omitted
Caused by: java.net.ConnectException: Connection timed out: connect
	at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:589)
	at oracle.net.nt.TcpNTAdapter.connect(TcpNTAdapter.java:141)
	at oracle.net.nt.ConnOption.connect(ConnOption.java:123)
	at oracle.net.nt.ConnStrategy.execute(ConnStrategy.java:337)
	... 91 common frames omitted

2019-04-15 17:57:44.124 ERROR 8532 --- [http-nio-8081-exec-6] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 407, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG,2) END  wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 407, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 407, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7'); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 407, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$e5e4f5a5.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$eda6b3c1.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 407, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,CASE WHEN FKIMG=0 THEN 0 ELSE  round((NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG,2) END  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 407, line 2, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

2019-04-15 18:00:32.769 ERROR 8996 --- [http-nio-8081-exec-7] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 412, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,round( CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END,2)*100  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,round( CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END,2)*100  wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 412, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,round( CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END,2)*100  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 412, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,round( CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END,2)*100  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7'); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 412, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,round( CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END,2)*100  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$1ad1e994.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$2497e7f7.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 412, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL ,round( CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END,2)*100  wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 412, line 2, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

2019-04-15 18:02:04.385 ERROR 5672 --- [http-nio-8081-exec-7] c.h.erp.core.aop.GlobalExceptionHandler  : 运行时异常:

org.springframework.jdbc.UncategorizedSQLException: 
### Error querying database.  Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL , CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### The error may exist in file [E:\newcode2\news\hbis_erp\target\classes\cn\hbis\erp\modular\system\mapper\mapping\ScmSteelSettleMapper.xml]
### The error may involve cn.hbis.erp.modular.system.mapper.ScmSteelSettleMapper.getzgsjswc
### The error occurred while executing a query
### SQL: select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL , CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END wcl from (selec         COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '专业公司' then fkimg end) zybz,         sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  sale_body = '分公司' then fkimg end) fgsbz,         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9580','9727','9193')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         union all (         select         COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ         from (SELECT         COMPANYNAME,          sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,         sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,         sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,         sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '专业公司' then fkimg end) zybz,         sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when sale_body = '分公司' then fkimg end) fgsbz,         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/         sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         sso.sale_body ss,         (select max(DATA.Name)         from scm_delivery_detail detail         JOIN crm_resource_data DATA         ON DATA.full_name = detail.ext         AND DATA.company_id = detail.company_id         AND (DATA.TYPE = 6 )          where  detail.DELIV_NUMB = settle.vgbel         and detail.ORDER_NO = settle.aubel         and detail.ORDER_ITEM = settle.aupos         and detail.company_id =settle.company_id         and ( detail.delivery_delete  <> 'X' or         detail.delivery_delete is null)) name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group          left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and         xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and         xsztdzb.sale_body_des <> '出口'  and         xsztdzb.sale_body_des <> '唐银联营公司数据'         and  settle.company_id in ('9196')         order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0)         and t.name is not null group by  t.companyname) a         )         union all         ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,         zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,         (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,         (zypzgl/zyfkimg) zypzgl,         (fgspzgl/fgsfkimg) fgsbz,         (zgspzgl/zgsfkimg) zgsbz         from(select  companyname,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)         zyfkimg,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)         zypzgl,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )         fgsfkimg,         sum( case when company_id='8110' then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )         fgspzgl,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)         zgsfkimg,         sum(case when company_id = '1932'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end         when company_id ='8493'  then         case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )         zgspzgl,         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)         sypzb,         (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/         sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))         hb         from (SELECT         distinct decode(settle.company_id,         9580,         '唐钢',         9727,         '邯钢',         9193,         '宣钢',         9196,         '承钢',         1932,         '舞钢',         8110,         '石钢',         8493,         '衡板',         7778,         '邯宝') AS companyname,         settle.company_id,         xsztdzb.sale_body,         sso.sale_body sggl,         rpcl.product_grade,         case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,         settle.id,         settle.fkdat,         sso.order_mount,         sso.order_type_describe,         sso.saler_name,         sso.sale_group,         decode(settle.company_id,         1932,         '宽厚板',         8110,         '特钢',         8493,         '薄板') AS name,         (select max(detail.ext)         from scm_delivery_detail detail         where settle.company_id = detail.company_id         and settle.vgbel = detail.deliv_numb         and settle.vgpos = detail.deliv_item         and ( detail.delivery_delete  <> 'X'  or         detail.delivery_delete is null))product_line         FROM scm_steel_settle settle         left join scm_sale_order sso         on settle.company_id = sso.company_id         and settle.aubel = sso.order_no         and settle.aupos = sso.order_row         left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb         ON sso.company_id = xsztdzb.company_id         AND sso.sale_body = xsztdzb.sale_body_des         inner join scm_variety_to_pt_gp svtp         on sso.company_id = svtp.company_id         and sso.product_code = svtp.product_group         left join (SELECT a.company_id,         a.product_class,         a.product_line_class,         a.product_class_crude,         a.product_class_fine,         a.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL a         where a.status = '0'         union all         SELECT b.company_id,         b.second_code,         b.product_line_class,         b.product_class_crude,         b.product_class_fine,         b.product_grade         FROM REPORT_PRODUCT_CLASS_LEVEL b         where b.status = '0') rpcl         on sso.company_id = rpcl.company_id         and sso.product_type = rpcl.product_class         where         settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')         and  settle.company_id in ('8110','8493','1932')          order by settle.id desc) t         where t.order_type_describe not in         (select distinct cfd.data_name         from crm_filter_data cfd         where cfd.data_type in ('5','1','7','9')         and cfd.status = '0'         and cfd.company_id = t.company_id)         and t.saler_name not in         (select cfd.data_name         from crm_filter_data cfd         where cfd.data_type = '1'         and cfd.status = '0'         and cfd.company_id = t.company_id         and instr(concat(t.product_line, t.company_id),         concat(cfd.product_line, cfd.company_id)) > 0)         AND t.sale_group NOT IN (SELECT cfd.data_name         FROM crm_filter_data cfd         WHERE cfd.company_id = t.company_id         AND cfd.data_type = 9         AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'         group by  t.companyname  )         ) ) where 1=1         order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
### Cause: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL , CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
; uncategorized SQLException; SQL state [null]; error code [0]; sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL , CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7'); nested exception is java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL , CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:89)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:81)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:73)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:446)
	at com.sun.proxy.$Proxy104.selectList(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:230)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.executeForMany(PageMapperMethod.java:173)
	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:86)
	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:64)
	at com.sun.proxy.$Proxy137.getzgsjswc(Unknown Source)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService.getzgsjswc(ScmSteelSettleService.java:72)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$FastClassBySpringCGLIB$$b0370e9a.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at com.alibaba.druid.support.spring.stat.DruidStatInterceptor.invoke(DruidStatInterceptor.java:72)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.service.ScmSteelSettleService$$EnhancerBySpringCGLIB$$88188b76.getzgsjswc(<generated>)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController.getpzgjswc(ScmSteelSettleController.java:137)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$FastClassBySpringCGLIB$$68731f5e.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:749)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:88)
	at cn.hbis.erp.core.interceptor.SessionHolderInterceptor.sessionKit(SessionHolderInterceptor.java:29)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:644)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:633)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:93)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:688)
	at cn.hbis.erp.modular.system.controller.ScmSteelSettleController$$EnhancerBySpringCGLIB$$87466cca.getpzgjswc(<generated>)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:189)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:800)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1038)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:96)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at cn.stylefeng.roses.core.xss.XssFilter.doFilter(XssFilter.java:31)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at com.alibaba.druid.support.http.WebStatFilter.doFilter(WebStatFilter.java:123)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:791)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1417)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.sql.SQLException: sql injection violation, syntax error: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM : select COMPANYNAME  name,FKIMG jsl,(NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0)) PZGL , CASE WHEN FKIMG=0 THEN 0 ELSE  (NVL(ZYPZGL,0)+NVL(ZGSPZGL,0)+ NVL(FGSPZGL,0))/FKIMG END wcl from (selec
        COMPANYNAME,  (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when  sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when  sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when  sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '专业公司' then fkimg end) zybz,
        sum(case when  sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when  (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when  product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9580','9727','9193')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        union all (
        select
        COMPANYNAME,   (NVL(ZYFKIMG,0)+ NVL(FGSFKIMG,0)+ NVL(ZGSFKIMG,0)) FKIMG, PZGL , ZYFKIMG, ZYPZGL,  FGSFKIMG,  FGSPZGL, ZGSFKIMG,  ZGSPZGL, SYPZB, HB,  BZ,'1' SX,  ZYBZ, FGSBZ,ZGSBZ ZGSBZ
        from (SELECT
        COMPANYNAME,

        sum(case when product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)pzgl,
        sum(case when sale_body = '专业公司' then fkimg end)zyfkimg,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)zypzgl,
        sum(case when sale_body = '分公司' then fkimg end)fgsfkimg,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) fgspzgl,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsfkimg,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end) zgspzgl,
        sum(case when sale_body = '专业公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '专业公司' then fkimg end) zybz,
        sum(case when sale_body = '分公司' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when sale_body = '分公司' then fkimg end) fgsbz,
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)/
        sum(case when (sale_body ='事业部'  or sale_body  = '现货' or sale_body='技术中心/市场部') or (ss = '唐钢自办公司'  or ss = '自办公司-唐钢商贸' or ss = '自办公司-保定板材')  then fkimg end) zgsbz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) bz,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end) sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        sso.sale_body ss,
        (select max(DATA.Name)
        from scm_delivery_detail detail
        JOIN crm_resource_data DATA
        ON DATA.full_name = detail.ext
        AND DATA.company_id = detail.company_id
        AND (DATA.TYPE = 6 )

        where  detail.DELIV_NUMB = settle.vgbel
        and detail.ORDER_NO = settle.aubel
        and detail.ORDER_ITEM = settle.aupos
        and detail.company_id =settle.company_id
        and ( detail.delivery_delete  <> 'X' or
        detail.delivery_delete is null)) name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group

        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        AND xsztdzb.sale_body_des  <>'唐钢中厚板公司'  and
        xsztdzb.sale_body_des  <>'唐钢不锈钢公司' and
        xsztdzb.sale_body_des <> '出口'  and
        xsztdzb.sale_body_des <> '唐银联营公司数据'
        and  settle.company_id in ('9196')
        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0)
        and t.name is not null group by  t.companyname) a
        )
        union all
        ( select companyname,nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0) fkimg,nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0) pzgl,
        zyfkimg,zypzgl,fgsfkimg,fgspzgl,zgsfkimg,zgspzgl,sypzb,hb,
        (nvl(zypzgl,0)+nvl(fgspzgl,0)+nvl(zgspzgl,0))/(nvl(zyfkimg,0)+ nvl(fgsfkimg,0) +nvl(zgsfkimg,0)) bz,'2'sx,
        (zypzgl/zyfkimg) zypzgl,
        (fgspzgl/fgsfkimg) fgsbz,
        (zgspzgl/zgsfkimg) zgsbz
        from(select  companyname,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' then case when fkimg is null then 0 else fkimg end end)
        zyfkimg,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and sale_group = '销售部' and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end)
        zypzgl,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口')  then fkimg end else null end )
        fgsfkimg,
        sum( case when company_id='8110' then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sggl = '分公司'  or sale_body <> '出口') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end else null end )
        fgspzgl,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部')  then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' )  then fkimg end end)
        zgsfkimg,
        sum(case when company_id = '1932'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '科技部') and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end
        when company_id ='8493'  then
        case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and (sale_group = '营销中心' or sale_group ='1000' ) and (product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品') then fkimg end  end )
        zgspzgl,
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  < = to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end)
        sypzb,
        (sum(case when fkdat > = to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date (?,'yyyy-mm-dd hh24:mi:ss')then fkimg end))-(sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss') and product_grade = '品种钢' OR product_grade = '高端产品' OR product_grade = '特色战略产品' then fkimg end)/
        sum(case when fkdat >= to_date (?,'yyyy-mm-dd hh24:mi:ss') and fkdat  <= to_date ('2019-02-28','yyyy-mm-dd hh24:mi:ss')then fkimg end))
        hb
        from (SELECT
        distinct decode(settle.company_id,
        9580,
        '唐钢',
        9727,
        '邯钢',
        9193,
        '宣钢',
        9196,
        '承钢',
        1932,
        '舞钢',
        8110,
        '石钢',
        8493,
        '衡板',
        7778,
        '邯宝') AS companyname,
        settle.company_id,
        xsztdzb.sale_body,
        sso.sale_body sggl,
        rpcl.product_grade,
        case when settle.fkimg='0.00' then null else settle.fkimg end fkimg  ,
        settle.id,
        settle.fkdat,
        sso.order_mount,
        sso.order_type_describe,
        sso.saler_name,
        sso.sale_group,
        decode(settle.company_id,
        1932,
        '宽厚板',
        8110,
        '特钢',
        8493,
        '薄板') AS name,
        (select max(detail.ext)
        from scm_delivery_detail detail
        where settle.company_id = detail.company_id
        and settle.vgbel = detail.deliv_numb
        and settle.vgpos = detail.deliv_item
        and ( detail.delivery_delete  <> 'X'  or
        detail.delivery_delete is null))product_line
        FROM scm_steel_settle settle
        left join scm_sale_order sso
        on settle.company_id = sso.company_id
        and settle.aubel = sso.order_no
        and settle.aupos = sso.order_row
        left join (select a.* from price_salebody_relation a where a.is_delete = 0 ) xsztdzb
        ON sso.company_id = xsztdzb.company_id
        AND sso.sale_body = xsztdzb.sale_body_des
        inner join scm_variety_to_pt_gp svtp
        on sso.company_id = svtp.company_id
        and sso.product_code = svtp.product_group
        left join (SELECT a.company_id,
        a.product_class,
        a.product_line_class,
        a.product_class_crude,
        a.product_class_fine,
        a.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL a
        where a.status = '0'
        union all
        SELECT b.company_id,
        b.second_code,
        b.product_line_class,
        b.product_class_crude,
        b.product_class_fine,
        b.product_grade
        FROM REPORT_PRODUCT_CLASS_LEVEL b
        where b.status = '0') rpcl
        on sso.company_id = rpcl.company_id
        and sso.product_type = rpcl.product_class
        where
        settle.fkdat>= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and settle.fkdat <= to_date(?, 'yyyy-mm-dd hh24:mi:ss')
        and  settle.company_id in ('8110','8493','1932')

        order by settle.id desc) t
        where t.order_type_describe not in
        (select distinct cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type in ('5','1','7','9')
        and cfd.status = '0'
        and cfd.company_id = t.company_id)
        and t.saler_name not in
        (select cfd.data_name
        from crm_filter_data cfd
        where cfd.data_type = '1'
        and cfd.status = '0'
        and cfd.company_id = t.company_id
        and instr(concat(t.product_line, t.company_id),
        concat(cfd.product_line, cfd.company_id)) > 0)
        AND t.sale_group NOT IN (SELECT cfd.data_name
        FROM crm_filter_data cfd
        WHERE cfd.company_id = t.company_id
        AND cfd.data_type = 9
        AND cfd.status = 0) and  t.NAME <> '唐钢1580热轧线'  and  t.name <> '唐钢中厚板'
        group by  t.companyname  )
        ) ) where 1=1
        order by "DECODE"(COMPANYNAME,'唐钢','1','邯钢','2','宣钢','3','承钢','4','舞钢','5','石钢','6','衡板','7')
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:799)
	at com.alibaba.druid.wall.WallFilter.connection_prepareStatement(WallFilter.java:252)
	at com.alibaba.druid.filter.FilterChainImpl.connection_prepareStatement(FilterChainImpl.java:568)
	at com.alibaba.druid.proxy.jdbc.ConnectionProxyImpl.prepareStatement(ConnectionProxyImpl.java:342)
	at com.alibaba.druid.pool.DruidPooledConnection.prepareStatement(DruidPooledConnection.java:349)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.logging.jdbc.ConnectionLogger.invoke(ConnectionLogger.java:55)
	at com.sun.proxy.$Proxy181.prepareStatement(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:87)
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:88)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:59)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Invocation.proceed(Invocation.java:49)
	at com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor.intercept(PaginationInterceptor.java:158)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:61)
	at com.sun.proxy.$Proxy180.prepare(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:85)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:62)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:326)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:83)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:148)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:433)
	... 112 common frames omitted
Caused by: com.alibaba.druid.sql.parser.ParserException: syntax error, error in :'     from (SELECT
        COMPANYNA', expect RPAREN, actual FROM pos 398, line 2, column 194, token FROM
	at com.alibaba.druid.sql.parser.SQLParser.printError(SQLParser.java:284)
	at com.alibaba.druid.sql.parser.SQLParser.accept(SQLParser.java:292)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSourcePrimary(OracleSelectParser.java:627)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.parseTableSource(OracleSelectParser.java:607)
	at com.alibaba.druid.sql.parser.SQLSelectParser.parseFrom(SQLSelectParser.java:666)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.query(OracleSelectParser.java:304)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleSelectParser.select(OracleSelectParser.java:75)
	at com.alibaba.druid.sql.dialect.oracle.parser.OracleStatementParser.parseStatementList(OracleStatementParser.java:96)
	at com.alibaba.druid.sql.parser.SQLStatementParser.parseStatementList(SQLStatementParser.java:83)
	at com.alibaba.druid.wall.WallProvider.checkInternal(WallProvider.java:624)
	at com.alibaba.druid.wall.WallProvider.check(WallProvider.java:578)
	at com.alibaba.druid.wall.WallFilter.checkInternal(WallFilter.java:786)
	... 146 common frames omitted

